<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Répertoire des Extensions de Fichiers</title>
    <style>
        /* --- Palette de Couleurs ---
        #424549 - Gris moyen (pour les descriptions)
        #36393E - Gris foncé (pour les titres et bords)
        #282B30 - Noir presque (pour les fiches d'extension et le champ de recherche)
        #1E2124 - Noir très foncé (fond principal)
        #559fff - Bleu vif (accent)
        -------------------------- */

        /* --- CSS Global --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #1E2124; /* Noir très foncé */
            color: #f0f2f5; /* Texte clair pour le contraste général */
        }

        h1 {
            color: #559fff; /* Bleu vif */
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            letter-spacing: -0.5px;
            text-shadow: 0 0 10px rgba(85, 159, 255, 0.4);
        }

        /* --- Conteneur principal --- */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #282B30; /* Noir presque */
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        /* --- Champ de recherche --- */
        #searchBar {
            width: calc(100% - 40px); /* Ajuster pour le padding */
            padding: 15px 20px;
            margin-bottom: 25px;
            border: none;
            border-radius: 5px;
            background-color: #36393E; /* Gris foncé */
            color: #f0f2f5;
            font-size: 1.1em;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        #searchBar::placeholder {
            color: #888;
        }

        #searchBar:focus {
            background-color: #424549; /* Gris moyen au focus */
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3), 0 0 0 2px #559fff; /* Bordure bleue au focus */
            outline: none;
        }

        /* --- Grille des extensions --- */
        #extensionsGrid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            padding: 10px 0;
        }

        /* --- Fiche d'extension --- */
        .extension-card {
            background-color: #282B30; /* Noir presque */
            border: 1px solid #36393E; /* Gris foncé */
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
            cursor: pointer;
        }

        .extension-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            border-color: #559fff; /* Bordure bleue au survol */
        }

        .extension-card h2 {
            color: #559fff; /* Bleu vif */
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.8em;
            letter-spacing: -0.2px;
            text-shadow: 0 0 5px rgba(85, 159, 255, 0.2);
        }

        .extension-card p {
            color: #b0b3b8; /* Gris très clair */
            font-size: 1em;
            flex-grow: 1; /* Pour que la description prenne de l'espace */
        }

        .extension-card .software-list {
            margin-top: 15px;
            border-top: 1px solid #36393E;
            padding-top: 15px;
        }

        .extension-card .software-list h3 {
            color: #f0f2f5;
            font-size: 1.1em;
            margin-top: 0;
            margin-bottom: 8px;
        }

        .extension-card .software-list ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .extension-card .software-list li {
            background-color: #36393E;
            color: #f0f2f5;
            padding: 5px 10px;
            margin-bottom: 5px;
            border-radius: 3px;
            font-size: 0.9em;
            display: inline-block; /* Pour les afficher en ligne */
            margin-right: 5px;
        }

        /* --- Boutons --- */
        .buttons-container {
            text-align: center;
            margin-top: 30px;
            margin-bottom: 20px;
        }

        .buttons-container button {
            background-color: #559fff; /* Bleu vif */
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin: 0 10px;
        }

        .buttons-container button:hover {
            background-color: #4086e3; /* Bleu plus foncé au survol */
            transform: translateY(-2px);
        }

        /* --- Modales --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: #282B30;
            color: #f0f2f5;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
            width: 90%;
            max-width: 600px;
            text-align: center;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }

        .modal-overlay.visible .modal-content {
            transform: scale(1);
        }

        .modal-content h2 {
            color: #559fff;
            margin-top: 0;
            margin-bottom: 20px;
        }

        .modal-content p {
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .modal-content ul {
            list-style: none;
            padding: 0;
            max-height: 250px; /* Limite la hauteur pour le défilement */
            overflow-y: auto; /* Active le défilement vertical */
            margin-bottom: 20px;
            border-top: 1px solid #36393E;
            padding-top: 15px;
        }

        .modal-content li {
            background-color: #36393E;
            padding: 8px 15px;
            margin-bottom: 8px;
            border-radius: 4px;
            text-align: left;
            font-size: 1em;
        }

        .modal-content button {
            background-color: #559fff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin: 0 10px;
            transition: background-color 0.3s ease;
        }

        .modal-content button:hover {
            background-color: #4086e3;
        }

        /* --- Styles des filtres (si ajoutés plus tard) --- */
        .filters-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .filters-container select {
            padding: 10px 15px;
            border-radius: 5px;
            border: 1px solid #36393E;
            background-color: #282B30;
            color: #f0f2f5;
            font-size: 1em;
            margin-right: 10px;
            appearance: none; /* Supprime le style par défaut du sélecteur */
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23f0f2f5%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-6.5%200-12.3%203.2-15.6%208.1-3.3%204.8-2.3%2011.1%202.9%2015.4l128.6%20127.9c5.3%205.3%2013.8%205.3%2019.1%200l128.6-127.9c5.2-4.3%206.2-10.6%202.9-15.4z%22%2F%3E%3C%2Fsvg%3E'); /* Flèche personnalisée */
            background-repeat: no-repeat;
            background-position: right 10px top 50%;
            background-size: 12px auto;
        }

        .filters-container select:focus {
            outline: none;
            border-color: #559fff;
            box-shadow: 0 0 0 2px rgba(85, 159, 255, 0.5);
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 2em;
            }

            .buttons-container button {
                width: 90%;
                margin: 10px auto;
            }

            #extensionsGrid {
                grid-template-columns: 1fr; /* Une seule colonne sur petits écrans */
            }

            .modal-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Répertoire des Extensions de Fichiers</h1>
        <input type="text" id="searchBar" placeholder="Rechercher une extension, une description ou un logiciel...">

        <div class="buttons-container">
            <button id="downloadAllFilesBtn">Télécharger tous les fichiers</button>
        </div>

        <div id="extensionsGrid">
            </div>
    </div>

    <div id="softwareModalOverlay" class="modal-overlay">
        <div id="softwareModalContent" class="modal-content">
            <h2 id="modalExtensionTitle"></h2>
            <h3>Logiciels Communs :</h3>
            <ul id="modalSoftwareList">
                </ul>
            <button onclick="closeSoftwareModal()">Fermer</button>
        </div>
    </div>

    <div id="downloadWarningModalOverlay" class="modal-overlay">
        <div id="downloadWarningModalContent" class="modal-content">
            <h2>Confirmation de téléchargement</h2>
            <p>Vous êtes sur le point de télécharger un fichier ZIP contenant un fichier vide pour chaque extension listée sur cette page.</p>
            <p>Nombre de fichiers : <span id="numExtensions"></span></p>
            <p>Taille estimée du fichier ZIP : <span id="estimatedSize">Calcul en cours...</span></p>
            <p>Confirmez-vous le téléchargement ?</p>
            <button onclick="confirmDownload()">Confirmer</button>
            <button onclick="closeDownloadWarning()">Annuler</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <script>
        let allExtensions = [];
        const extensionsGrid = document.getElementById('extensionsGrid');
        const searchBar = document.getElementById('searchBar');
        const softwareModalOverlay = document.getElementById('softwareModalOverlay');
        const modalExtensionTitle = document.getElementById('modalExtensionTitle');
        const modalSoftwareList = document.getElementById('modalSoftwareList');
        const downloadWarningModalOverlay = document.getElementById('downloadWarningModalOverlay');

        // Fetch des données JSON (utilisez l'URL complète si vous hébergez le JSON sur GitHub)
        fetch('https://raw.githubusercontent.com/Tristanox/textures/refs/heads/main/extension-data.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                allExtensions = data.map(item => ({
                    ext: item["nom d'extension"].replace('.', '').toLowerCase(),
                    title: item.description, // Assuming description maps to title as the previous 'title' was not in json
                    description: item.description,
                    commonSoftware: item["logiciels communs"]
                }));
                displayExtensions(allExtensions); // Afficher les extensions après le chargement des données
            })
            .catch(error => {
                console.error('There has been a problem with your fetch operation:', error);
                extensionsGrid.innerHTML = '<p>Impossible de charger les extensions. Veuillez vérifier votre connexion ou l\'URL des données.</p>';
            });


        // Fonction pour afficher les extensions filtrées
        function displayExtensions(extensionsToShow) {
            extensionsGrid.innerHTML = ''; // Nettoyer la grille avant d'ajouter de nouvelles fiches
            if (extensionsToShow.length === 0) {
                extensionsGrid.innerHTML = '<p style="color: #b0b3b8; text-align: center; width: 100%;">Aucune extension trouvée.</p>';
                return;
            }

            extensionsToShow.forEach(extInfo => {
                const card = document.createElement('div');
                card.classList.add('extension-card');

                card.innerHTML = `
                    <h2>.${extInfo.ext}</h2>
                    <p>${extInfo.description}</p>
                    <div class="software-list">
                        <h3>Logiciels communs :</h3>
                        <ul>
                            ${extInfo.commonSoftware.map(software => `<li>${software}</li>`).join('')}
                        </ul>
                    </div>
                `;
                card.addEventListener('click', () => showSoftwareModal(extInfo));
                extensionsGrid.appendChild(card);
            });
        }

        // Gestionnaire d'événements pour la barre de recherche
        searchBar.addEventListener('input', () => {
            const searchTerm = searchBar.value.toLowerCase();
            const filteredExtensions = allExtensions.filter(extInfo =>
                extInfo.ext.includes(searchTerm) ||
                extInfo.description.toLowerCase().includes(searchTerm) ||
                extInfo.commonSoftware.some(software => software.toLowerCase().includes(searchTerm))
            );
            displayExtensions(filteredExtensions);
        });

        // Fonction pour afficher la modale des logiciels
        function showSoftwareModal(extInfo) {
            modalExtensionTitle.textContent = `.${extInfo.ext}`;
            modalSoftwareList.innerHTML = ''; // Nettoyer la liste
            extInfo.commonSoftware.forEach(software => {
                const listItem = document.createElement('li');
                listItem.textContent = software;
                modalSoftwareList.appendChild(listItem);
            });

            softwareModalOverlay.classList.add('visible');
        }

        // Fonction pour fermer la modale des logiciels
        function closeSoftwareModal() {
            softwareModalOverlay.classList.remove('visible');
        }

        // Fonctions pour le modal d'avertissement de téléchargement
        function showDownloadWarning() {
            const numFiles = allExtensions.length;
            // Estimation simple: 100-200 bytes par fichier vide + overhead du ZIP.
            // C'est une estimation TRÈS grossière, car la taille réelle dépend du système de fichiers
            // et de l'implémentation du ZIP, mais ça donne un ordre de grandeur.
            const estimatedSizeKB = (numFiles * 0.15) + (numFiles > 0 ? 50 : 0); // ~150 bytes/file + 50KB overhead
            let sizeText = "";

            if (estimatedSizeKB < 1024) {
                sizeText = `${estimatedSizeKB.toFixed(2)} Ko`;
            } else {
                sizeText = `${(estimatedSizeKB / 1024).toFixed(2)} Mo`;
            }

            document.getElementById('numExtensions').textContent = numFiles;
            document.getElementById('estimatedSize').textContent = sizeText;
            downloadWarningModalOverlay.classList.add('visible');
        }

        function closeDownloadWarning() {
            downloadWarningModalOverlay.classList.remove('visible');
        }

        function confirmDownload() {
            closeDownloadWarning();

            const zip = new JSZip();
            const zipFileName = 'extensions.zip';
            const emptyFileContent = ''; // Contenu vide pour les fichiers

            allExtensions.forEach(extInfo => {
                // Assurez-vous que votre objet extension a bien une propriété 'ext'
                // Exemple : { ext: "txt", ... }
                const filename = `file.${extInfo.ext}`;
                zip.file(filename, emptyFileContent);
            });

            // Générer le fichier ZIP
            zip.generateAsync({ type: "blob" })
                .then(function(content) {
                    // Créer un lien de téléchargement et le déclencher
                    const url = URL.createObjectURL(content);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = zipFileName;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url); // Libérer la mémoire de l'URL objet

                    console.log("Fichier ZIP créé et téléchargé avec succès !");
                })
                .catch(error => {
                    console.error("Erreur lors de la génération ou du téléchargement du fichier ZIP :", error);
                    alert("Une erreur est survenue lors de la création du fichier ZIP. Veuillez réessayer.");
                });
        }

        // Gestionnaire d'événements pour le bouton "Télécharger tous les fichiers"
        document.getElementById('downloadAllFilesBtn').addEventListener('click', showDownloadWarning);

        // La ligne suivante est commentée car displayExtensions est déjà appelée après le fetch des données.
        // document.addEventListener('DOMContentLoaded', () => {
        //     displayExtensions(allExtensions);
        // });
    </script>
</body>
</html>
