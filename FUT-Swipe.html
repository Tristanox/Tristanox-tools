<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FUT Swipe - Le Tinder des Joueurs</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg" href="https://www.logo.wine/a/logo/Tinder_(app)/Tinder_(app)-Flame-Logo.wine.svg">

    <style>
        /* --- Styles CSS --- */
        :root {
            --primary-pink: #EB106A;
            --secondary-red: #F05550;
            --card-background: #1a1a1a;
            --text-color: #f0f0f0;
            --like-color: #28a745;
            --dislike-color: #dc3545;
        }

        body {
            margin: 0;
            font-family: 'Poppins', sans-serif;
            color: var(--text-color);
            background: linear-gradient(to right, var(--primary-pink), var(--secondary-red));
            background-size: 100% 100%;
            background-attachment: fixed;
            
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh; 
            height: 100vh; 
            overflow: hidden; 
            position: relative;
            user-select: none; 
            
            width: 100%;
            max-width: 100%;
            max-height: 100%;
        }

        h1 {
            color: var(--text-color);
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            font-size: 2.5em;
            text-align: center;
            z-index: 10;
        }

        #swipeCounterTop {
            color: white;
            font-size: 1.5em;
            font-weight: 700;
            background-color: rgba(0, 0, 0, 0.3);
            padding: 5px 15px;
            border-radius: 10px;
            margin-bottom: 30px;
            z-index: 5;
        }

        /* Styles pour l'affichage du niveau */
        #levelDisplay {
            text-align: center; 
            margin-bottom: 20px; /* Réduit l'espace pour rapprocher le tout */
            font-weight: bold; 
            color: white;
            z-index: 5;
            width: 90%;
            max-width: 380px;
        }

        #levelDisplay #currentLevel {
            font-size: 1.8em;
            color: #ffde59;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        #levelDisplay #xpBarContainer {
            background-color: #333; 
            height: 12px; 
            width: 80%; 
            margin: 5px auto; 
            border-radius: 6px; 
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
        }
        
        #levelDisplay #xpBar {
            height: 100%; 
            width: 0%; 
            background-color: #00ff00; 
            border-radius: 6px;
            transition: width 0.3s ease-out, background-color 0.3s ease-out;
        }

        #levelDisplay #xpProgress {
            font-size: 0.9em;
            color: #ccc;
        }


        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 90%;
            max-width: 380px;
            perspective: 1000px;
            margin-top: 0;
            margin-left: auto;
            margin-right: auto;
            flex-grow: 1; 
            min-height: 0; 
        }

        .card-stack {
            position: relative;
            width: 100%;
            height: 520px; 
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0; 
        }

        /* Styles de la carte principale */
        .card {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: var(--card-background);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            overflow: hidden;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            cursor: grab;
            will-change: transform, opacity;
            top: 0;
            left: 0;
            margin-left: auto;
            margin-right: auto;
            right: 0;
        }

        .card-image {
            width: 100%;
            height: 70%; 
            object-fit: contain; 
            border-radius: 20px 20px 0 0; 
            transform: none; 
            transition: none; 
        }

        .card-info {
            display: flex; 
            padding: 15px;
            text-align: center;
            flex-grow: 1;
            flex-direction: column;
            justify-content: center;
            width: 100%;
            box-sizing: border-box;
        }

        .card-info .player-name {
            margin: 5px 0;
            font-size: 1.8em;
            font-weight: 700;
            color: #ffde59;
        }

        .card-info .player-ovr {
            margin: 2px 0;
            font-size: 1.2em;
            font-weight: 600;
            color: #fff;
        }

        .card-info .card-type {
            margin: 2px 0;
            font-size: 0.9em;
            color: #ccc;
        }

        .swipe-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            padding: 10px 20px;
            font-size: 3em;
            font-weight: bold;
            border-radius: 10px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
            z-index: 1000;
        }

        .swipe-message.like {
            color: var(--like-color);
            border: 3px solid var(--like-color);
            transform: translate(-50%, -50%) rotate(-45deg) scale(0.8);
        }

        .swipe-message.nope {
            color: var(--dislike-color);
            border: 3px solid var(--dislike-color);
            transform: translate(-50%, -50%) rotate(45deg) scale(0.8);
        }

        .swipe-message.visible {
            opacity: 1;
            transform: translate(-50%, -50%) rotate(0deg) scale(1);
        }

        .controls {
            margin-top: 30px;
            display: flex;
            gap: 20px;
            flex-shrink: 0; 
        }

        .control-button {
            background-color: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            color: var(--text-color);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .control-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .control-button.dislike {
            color: var(--dislike-color);
            border: 2px solid var(--dislike-color);
        }

        .control-button.like {
            color: var(--like-color);
            border: 2px solid var(--like-color);
        }

        .control-button:active {
            transform: scale(0.95);
        }

        /* Menu Burger et nouveaux boutons d'action */
        .menu-action-button {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: rgba(128, 128, 128, 0.5);
            border: none;
            color: white;
            font-size: 1.8em;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 2000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            transition: background-color 0.2s ease, transform 0.1s ease;
        }

        .menu-action-button:hover {
            background-color: rgba(128, 128, 128, 0.7);
            transform: translateY(-1px);
        }

        .menu-action-button:active {
            transform: scale(0.95);
        }

        #burgerMenuBtn {
            top: 20px;
            left: 20px;
        }

        #exportStatsBtn {
            top: 20px; 
            right: 20px;
            left: auto;
            font-size: 1.5em; /* Ajustement de la taille de l'icône */
        }

        #importStatsBtn {
            top: 80px; 
            right: 20px;
            left: auto;
            font-size: 1.5em; /* Ajustement de la taille de l'icône */
        }

        #refreshSeriesBtn { /* Nouveau bouton */
            top: 140px; 
            right: 20px;
            left: auto;
            font-size: 1.5em; /* Ajustement de la taille de l'icône */
        }


        #sideMenu {
            position: fixed;
            top: 0;
            left: -300px; 
            width: 280px;
            height: 100%;
            background-color: var(--card-background);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.5);
            z-index: 1500;
            transition: left 0.3s ease-out;
            padding-top: 60px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        #sideMenu.open {
            left: 0;
        }

        #sideMenu .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            color: var(--text-color);
            font-size: 2em;
            cursor: pointer;
            transition: color 0.2s;
        }

        #sideMenu .close-btn:hover {
            color: var(--secondary-red);
        }

        #sideMenu ul {
            list-style: none;
            padding: 0;
            width: 100%;
        }

        #sideMenu ul li {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        #sideMenu ul li:last-child {
            border-bottom: none;
        }

        #sideMenu ul li a, #sideMenu ul li button {
            color: var(--text-color);
            text-decoration: none;
            font-size: 1.2em;
            display: block;
            background: none;
            border: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            transition: color 0.2s;
        }

        #sideMenu ul li a:hover, #sideMenu ul li button:hover {
            color: var(--primary-pink);
        }

        /* Modal de sélection de la série (maintenant pour les réglages) */
        #seriesSelectionModal {
            display: none;
            position: fixed;
            z-index: 10001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
        }

        .series-modal-content {
            background: var(--card-background);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            text-align: center;
            animation: bounceIn 0.5s ease-out;
            position: relative;
        }

        .series-modal-content h2 {
            color: var(--secondary-red);
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .series-options {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .series-options label {
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .series-options input[type="range"] {
            width: 80%;
            -webkit-appearance: none;
            height: 8px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .series-options input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: var(--primary-pink);
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }

        .series-options input[type="range"]::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: var(--primary-pink);
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }

        .series-options #sliderValue {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--primary-pink);
            margin-top: -10px;
            margin-bottom: 15px;
        }

        .series-options button#applySeriesLengthBtn {
            background-color: var(--primary-pink);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            margin-top: 15px;
        }
        .series-options button#applySeriesLengthBtn:hover {
            background-color: #d10e5d;
            transform: translateY(-2px);
        }
        .series-options button#applySeriesLengthBtn:active {
            transform: scale(0.98);
        }

        .series-modal-close-btn {
            color: var(--text-color);
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }

        .series-modal-close-btn:hover,
        .series-modal-close-btn:focus {
            color: var(--secondary-red);
            text-decoration: none;
            cursor: pointer;
        }

        /* Modal Preset de Cartes - Styles mis à jour pour sélection multiple */
        #presetSelectionModal {
            display: none;
            position: fixed;
            z-index: 10002;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
        }

        .preset-modal-content {
            background: var(--card-background);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 1200px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            text-align: center;
            animation: bounceIn 0.5s ease-out;
            position: relative;
            max-height: 100vh;
            overflow-y: hidden; /* Maintenir le scroll sur la grille interne */
        }

        .preset-modal-content h2 {
            color: var(--secondary-red);
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .preset-options-grid { /* Nouvelle grille pour les options de preset */
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 20px;
            max-height: 400px; /* Limite la hauteur pour le défilement */
            overflow-y: auto;
            padding-right: 5px; /* Pour la barre de défilement */
        }

        .preset-option-item {
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: background-color 0.2s ease, transform 0.1s ease, border-color 0.2s ease;
        }

        .preset-option-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }
        .preset-option-item.selected { /* Style pour les éléments sélectionnés */
            background-color: var(--primary-pink);
            border-color: var(--primary-pink);
            box-shadow: 0 0 10px rgba(235, 16, 106, 0.5);
        }
        .preset-option-item input[type="checkbox"] {
            margin-right: 10px;
            width: 20px;
            height: 20px;
            accent-color: var(--secondary-red); /* Style de la case à cocher */
            cursor: pointer;
        }
        .preset-option-item label {
            flex-grow: 1;
            text-align: left;
            cursor: pointer;
            font-size: 1.1em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .preset-option-item .card-count {
            font-size: 0.9em;
            color: #bbb;
            background-color: rgba(0,0,0,0.2);
            padding: 3px 8px;
            border-radius: 5px;
            margin-left: 10px;
        }

        button#applyPresetFilterBtn { /* Nouveau bouton d'application */
            background-color: var(--primary-pink);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            margin-top: 25px; /* Espace au-dessus */
        }
        button#applyPresetFilterBtn:hover {
            background-color: #d10e5d;
            transform: translateY(-2px);
        }
        button#applyPresetFilterBtn:active {
            transform: scale(0.98);
        }


        .preset-modal-close-btn {
            color: var(--text-color);
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }

        .preset-modal-close-btn:hover,
        .preset-modal-close-btn:focus {
            color: var(--secondary-red);
            text-decoration: none;
            cursor: pointer;
        }

        /* Modal Sélection OVR */
        #ovrSelectionModal {
            display: none;
            position: fixed;
            z-index: 10003;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
        }

        .ovr-modal-content {
            background: var(--card-background);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            text-align: center;
            animation: bounceIn 0.5s ease-out;
            position: relative;
        }

        .ovr-modal-content h2 {
            color: var(--secondary-red);
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .ovr-options {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .ovr-options label {
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .ovr-options .slider-group {
            width: 80%;
            margin-bottom: 20px;
        }

        .ovr-options input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            height: 8px;
            background: linear-gradient(to right, var(--primary-pink) 0%, var(--secondary-red) 100%);
            outline: none;
            opacity: 0.9;
            transition: opacity .2s;
            border-radius: 5px;
            margin-bottom: 5px;
        }

        .ovr-options input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #fff;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
            border: 2px solid var(--primary-pink);
        }

        .ovr-options input[type="range"]::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #fff;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
            border: 2px solid var(--primary-pink);
        }

        .ovr-options #ovrRangeValue {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--primary-pink);
            margin-bottom: 15px;
        }

        .ovr-options button#applyOvrFilterBtn {
            background-color: var(--primary-pink);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            margin-top: 15px;
        }
        .ovr-options button#applyOvrFilterBtn:hover {
            background-color: #d10e5d;
            transform: translateY(-2px);
        }
        .ovr-options button#applyOvrFilterBtn:active {
            transform: scale(0.98);
        }

        .ovr-modal-close-btn {
            color: var(--text-color);
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }

        .ovr-modal-close-btn:hover,
        .ovr-modal-close-btn:focus {
            color: var(--secondary-red);
            text-decoration: none;
            cursor: pointer;
        }

        /* Modal pour l'équipe finale (Collection) */
        #teamModal, #collectionModal { /* Applique les mêmes styles de base pour les modals plein écran */
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--card-background);
            padding: 30px;
            border-radius: 20px;
            width: 90vw;
            height: 90vh;
            max-width: 950px;
            max-height: 800px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.7);
            text-align: center;
            position: relative;
            animation: fadeIn 0.3s ease-out;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .modal-content h2 {
            color: var(--secondary-red);
            margin-bottom: 20px;
            font-size: 2.2em;
            flex-shrink: 0;
        }

        #teamOverallRating, #collectionCount {
            font-size: 1.8em;
            font-weight: bold;
            color: #ffde59;
            margin-bottom: 20px;
            flex-shrink: 0;
        }

        .team-grid, .collection-grid { /* Applique les mêmes styles de grille */
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 15px;
            margin-top: 0;
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 10px;
            padding-bottom: 10px;
            justify-items: center;
        }

        .team-player-card { /* Utilisé pour les cartes dans la modal de collection aussi */
            background-color: transparent;
            border-radius: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            box-shadow: none;
            width: 100%;
            max-width: 150px;
            position: relative;
            transition: transform 0.2s ease;
        }

        .team-player-card:hover {
            transform: translateY(-5px);
        }

        .team-player-card img {
            width: 100%;
            height: auto;
            object-fit: contain;
            border-radius: 0;
            border: none;
            display: block;
        }

        .team-player-card .player-details {
            position: absolute;
            bottom: 5px;
            left: 0;
            right: 0;
            color: white;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
            font-size: 0.8em;
            line-height: 1.2;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%);
            padding-top: 30px;
            padding-bottom: 5px;
        }
        .team-player-card .player-details p {
            margin: 0;
        }
        .team-player-card .player-details .player-ovr {
            font-size: 1.1em;
            font-weight: bold;
            color: #ffde59;
        }
        .team-player-card .player-details .player-name-modal {
            font-size: 1.1em;
            font-weight: 600;
        }
        .team-player-card .player-details .card-type-modal {
            font-size: 0.7em;
            opacity: 0.8;
        }


        .close-button {
            color: var(--text-color);
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
            z-index: 10;
        }

        .close-button:hover,
        .close-button:focus {
            color: var(--secondary-red);
            text-decoration: none;
            cursor: pointer;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes bounceIn {
            0%, 20%, 40%, 60%, 80%, 100% {
                transition-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000);
            }
            0% {
                opacity: 0;
                transform: scale3d(.3, .3, .3);
            }
            20% {
                transform: scale3d(1.1, 1.1, 1.1);
            }
            40% {
                transform: scale3d(.9, .9, .9);
            }
            60% {
                opacity: 1;
                transform: scale3d(1.03, 1.03, 1.03);
            }
            80% {
                transform: scale3d(.97, .97, .97);
            }
            100% {
                opacity: 1;
                transform: scale3d(1, 1, 1);
            }
        }
    </style>
</head>
<body>
    <button id="burgerMenuBtn" class="menu-action-button">☰</button>
    <button id="exportStatsBtn" class="menu-action-button">💾</button>
    <button id="importStatsBtn" class="menu-action-button">⬆️</button>
    <button id="refreshSeriesBtn" class="menu-action-button">🔄</button>

    <div class="swipe-message like" id="likeMessage">LIKE</div>
    <div class="swipe-message nope" id="nopeMessage">NOPE</div>

    <h1>FUT Swipe</h1>
    
    <div id="levelDisplay">
        Niveau: <span id="currentLevel">1</span>
        <div id="xpBarContainer">
            <div id="xpBar"></div>
        </div>
        <span id="xpProgress">0 / 100 XP</span>
    </div>
    <div id="swipeCounterTop">0 / 0</div>

    <div class="container">
        <div class="card-stack" id="cardStack">
            </div>
        <div class="controls">
            <button class="control-button dislike" id="dislikeBtn">👎</button>
            <button class="control-button like" id="likeBtn">👍</button>
        </div>
        <p id="swipeCount" style="display:none;">Swipes: 0 / 100</p>
    </div>

    <div id="sideMenu">
        <span class="close-btn">&times;</span>
        <ul>
            <li><button id="resetGameMenuBtn">Nouvelle Partie</button></li>
            <li><button id="viewTeamMenuBtn">Voir l'Équipe</button></li>
            <li><button id="viewCollectionMenuBtn">Ma Collection</button></li> <li><button id="changeSeriesLengthBtn">Changer Longueur Série</button></li>
            <li><button id="choosePresetBtn">Choisir un Preset</button></li>
            <li><button id="filterByOVRBtn">Filtrer par Note (OVR)</button></li>
        </ul>
    </div>

    <div id="seriesSelectionModal">
        <div class="series-modal-content">
            <span class="close-button series-modal-close-btn">&times;</span>
            <h2>Ajuster la longueur de la série</h2>
            <div class="series-options">
                <label for="seriesRange">Nombre de swipes :</label>
                <input type="range" id="seriesRange" min="10" max="100" step="40" value="50">
                <span id="sliderValue">50</span>
                <button id="applySeriesLengthBtn">Appliquer & Recommencer</button>
            </div>
        </div>
    </div>

    <div id="presetSelectionModal">
        <div class="preset-modal-content">
            <span class="close-button preset-modal-close-btn">&times;</span>
            <h2>Choisir un ou plusieurs types de carte</h2>
            <div id="presetOptions" class="preset-options-grid"> 
                </div>
            <button id="applyPresetFilterBtn">Appliquer la sélection</button>
        </div>
    </div>

    <div id="ovrSelectionModal">
        <div class="ovr-modal-content">
            <span class="close-button ovr-modal-close-btn">&times;</span>
            <h2>Filtrer par Note (OVR)</h2>
            <div class="ovr-options">
                <label for="ovrMinRange">Note Minimale :</label>
                <div class="slider-group">
                    <input type="range" id="ovrMinRange" min="64" max="99" value="64">
                    <label for="ovrMaxRange">Note Maximale :</label>
                    <input type="range" id="ovrMaxRange" min="64" max="99" value="99">
                </div>
                <span id="ovrRangeValue">64 - 99</span>
                <button id="applyOvrFilterBtn">Appliquer & Recommencer</button>
            </div>
        </div>
    </div>


    <div id="teamModal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Votre Équipe de Rêve ! ⚽</h2>
            <div id="teamOverallRating">Note Générale de l'Équipe: -</div>
            <div id="teamGrid" class="team-grid">
                </div>
            <p style="margin-top: auto; font-size: 0.9em; color: #aaa; padding-top: 10px;">
                Cliquez sur un joueur pour voir plus de détails (fonctionnalité à venir).
            </p>
        </div>
    </div>

    <div id="collectionModal">
        <div class="modal-content">
            <span class="close-button" id="closeCollectionModalBtn">&times;</span>
            <h2>Ma Collection 🏆</h2>
            <div id="collectionCount">Total de cartes dans la collection : 0</div>
            <div id="collectionGrid" class="collection-grid">
                </div>
        </div>
    </div>

    <script>
        // --- JavaScript ---
        const cardStack = document.getElementById('cardStack');
        const dislikeBtn = document.getElementById('dislikeBtn');
        const likeBtn = document.getElementById('likeBtn');
        const swipeCounterTop = document.getElementById('swipeCounterTop');
        const likeMessage = document.getElementById('likeMessage');
        const nopeMessage = document.getElementById('nopeMessage');

        // Modals existants
        const teamModal = document.getElementById('teamModal');
        const teamGrid = document.getElementById('teamGrid');
        const teamOverallRating = document.getElementById('teamOverallRating');
        const closeTeamModalBtn = teamModal.querySelector('.close-button');

        const seriesSelectionModal = document.getElementById('seriesSelectionModal');
        const seriesRange = document.getElementById('seriesRange');
        const sliderValueDisplay = document.getElementById('sliderValue');
        const applySeriesLengthBtn = document.getElementById('applySeriesLengthBtn');
        const closeSeriesModalBtn = seriesSelectionModal.querySelector('.series-modal-close-btn');

        const presetSelectionModal = document.getElementById('presetSelectionModal');
        const presetOptionsDiv = document.getElementById('presetOptions'); // Nouveau conteneur pour les options de preset
        const applyPresetFilterBtn = document.getElementById('applyPresetFilterBtn'); // Nouveau bouton d'application
        const closePresetModalBtn = presetSelectionModal.querySelector('.preset-modal-close-btn');

        const ovrSelectionModal = document.getElementById('ovrSelectionModal');
        const ovrMinRange = document.getElementById('ovrMinRange');
        const ovrMaxRange = document.getElementById('ovrMaxRange');
        const ovrRangeValue = document.getElementById('ovrRangeValue');
        const applyOvrFilterBtn = document.getElementById('applyOvrFilterBtn');
        const closeOvrModalBtn = ovrSelectionModal.querySelector('.ovr-modal-close-btn');

        // Nouveaux éléments pour la collection
        const collectionModal = document.getElementById('collectionModal');
        const collectionGrid = document.getElementById('collectionGrid');
        const collectionCountDisplay = document.getElementById('collectionCount');
        const closeCollectionModalBtn = document.getElementById('closeCollectionModalBtn');


        // Éléments du menu Burger
        const burgerMenuBtn = document.getElementById('burgerMenuBtn');
        const sideMenu = document.getElementById('sideMenu');
        const closeSideMenuBtn = sideMenu.querySelector('.close-btn');
        const resetGameMenuBtn = document.getElementById('resetGameMenuBtn');
        const viewTeamMenuBtn = document.getElementById('viewTeamMenuBtn');
        const viewCollectionMenuBtn = document.getElementById('viewCollectionMenuBtn'); 
        const changeSeriesLengthBtn = document.getElementById('changeSeriesLengthBtn');
        const choosePresetBtn = document.getElementById('choosePresetBtn');
        const filterByOVRBtn = document.getElementById('filterByOVRBtn');

        // Nouveaux boutons d'export/import/refresh
        const exportStatsBtn = document.getElementById('exportStatsBtn');
        const importStatsBtn = document.getElementById('importStatsBtn');
        const refreshSeriesBtn = document.getElementById('refreshSeriesBtn');

        let allPlayersData = [];
        let cardTypesCount = {};
        let currentSessionPlayers = [];
        let likedPlayersInSession = []; 
        let permanentCollection = []; 
        let currentPlayerIndex = 0;
        let swipeCounter = 0;
        let MAX_SWIPES_PER_SESSION = 50;
        let availableCardTypes = [];
        let selectedCardPresets = ['all']; // Changé en tableau pour sélection multiple
        let ovrFilterMin = 64;
        let ovrFilterMax = 99;
        let maxOVRFound = 99;

        // --- Variables et Fonctions pour le Système de Niveaux ---
        let userLevel = 1;
        let currentXP = 0;
        const MAX_LEVEL = 100;

        // Fonction pour calculer l'XP nécessaire pour le prochain niveau
        function getXPForNextLevel(level) {
            if (level >= MAX_LEVEL) {
                return Infinity; // Pas d'XP nécessaire au-delà du niveau max
            }
            // Formule ajustée pour une progression plus rapide
            return Math.floor(50 + (level * level * 0.8));
        }

        // Référencez les éléments DOM pour l'affichage du niveau
        const currentLevelSpan = document.getElementById('currentLevel');
        const xpBar = document.getElementById('xpBar');
        const xpProgressSpan = document.getElementById('xpProgress');

        // Fonction pour ajouter de l'XP et vérifier le passage de niveau
        function addXP(amount) {
            currentXP += amount;
            console.log(`XP gagnés: +${amount}. Total XP: ${currentXP}`);

            let xpNeeded = getXPForNextLevel(userLevel);

            while (currentXP >= xpNeeded && userLevel < MAX_LEVEL) {
                currentXP -= xpNeeded; 
                userLevel++; 
                console.log(`Félicitations ! Vous avez atteint le Niveau ${userLevel} !`);
                // Vous pouvez ajouter ici des effets visuels ou sonores pour la montée de niveau
                xpNeeded = getXPForNextLevel(userLevel); 
            }
            
            if (userLevel === MAX_LEVEL && currentXP > 0) {
                currentXP = 0; 
            }
            
            saveUserData(); // Sauvegarde les données après chaque ajout d'XP
            updateLevelDisplay(); // Met à jour l'affichage de l'XP et du niveau
        }

        // Fonction pour charger les données de l'utilisateur depuis le localStorage
        function loadUserData() {
            const savedLevel = localStorage.getItem('futSwipeUserLevel');
            const savedXP = localStorage.getItem('futSwipeCurrentXP');
            const savedCollection = localStorage.getItem('futSwipePermanentCollection');
            const savedSessionLength = localStorage.getItem('futSwipeMaxSwipesPerSession');
            const savedCardPresets = localStorage.getItem('futSwipeCurrentCardPreset'); // Lire comme un tableau JSON
            const savedOVRMin = localStorage.getItem('futSwipeOVRMin');
            const savedOVRMax = localStorage.getItem('futSwipeOVRMax');

            if (savedLevel !== null) userLevel = parseInt(savedLevel);
            if (savedXP !== null) currentXP = parseInt(savedXP);
            if (savedCollection !== null) permanentCollection = JSON.parse(savedCollection);
            if (savedSessionLength !== null) MAX_SWIPES_PER_SESSION = parseInt(savedSessionLength);
            
            if (savedCardPresets !== null) {
                try {
                    const parsed = JSON.parse(savedCardPresets);
                    if (Array.isArray(parsed)) {
                        selectedCardPresets = parsed;
                    } else if (typeof parsed === 'string') { // Ancienne sauvegarde single-string format
                        selectedCardPresets = [parsed];
                    }
                } catch (e) {
                    // Fallback if parsing fails or old format is just a raw string
                    selectedCardPresets = [savedCardPresets];
                }
            }
            
            if (savedOVRMin !== null) ovrFilterMin = parseInt(savedOVRMin);
            if (savedOVRMax !== null) ovrFilterMax = parseInt(savedOVRMax);

            updateLevelDisplay(); // Met à jour l'affichage au chargement
        }

        // Fonction pour sauvegarder les données de l'utilisateur dans le localStorage
        function saveUserData() {
            localStorage.setItem('futSwipeUserLevel', userLevel);
            localStorage.setItem('futSwipeCurrentXP', currentXP);
            localStorage.setItem('futSwipePermanentCollection', JSON.stringify(permanentCollection));
            localStorage.setItem('futSwipeMaxSwipesPerSession', MAX_SWIPES_PER_SESSION);
            localStorage.setItem('futSwipeCurrentCardPreset', JSON.stringify(selectedCardPresets)); // Sauvegarde comme JSON string
            localStorage.setItem('futSwipeOVRMin', ovrFilterMin);
            localStorage.setItem('futSwipeOVRMax', ovrFilterMax);
        }
        
        // Fonction pour mettre à jour l'affichage du niveau et de la barre d'XP
        function updateLevelDisplay() {
            currentLevelSpan.textContent = userLevel;
            
            if (userLevel >= MAX_LEVEL) {
                xpProgressSpan.textContent = `Niveau Max (${MAX_LEVEL})`;
                xpBar.style.width = '100%';
                xpBar.style.backgroundColor = 'gold'; 
            } else {
                const xpNeeded = getXPForNextLevel(userLevel);
                const percentage = (currentXP / xpNeeded) * 100;
                xpBar.style.width = `${percentage}%`;
                xpBar.style.backgroundColor = '#00ff00'; 
                xpProgressSpan.textContent = `${currentXP} / ${xpNeeded} XP`;
            }
        }
        // --- Fin des Fonctions pour le Système de Niveaux ---


        // --- Fonctions utilitaires ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function formatPlayerNameAndOVR(url) {
            const parts = url.split('/');
            const filename = parts[parts.length - 1]; 

            const ovrMatch = filename.match(/_(\d+)_OVR/);
            const ovr = ovrMatch ? parseInt(ovrMatch[1]) : 0;

            const cleanFilename = filename.replace(/_\d+_OVR_.*\.webp$/, '').replace(/\.webp$/, '');
            
            const namePartsArray = cleanFilename.split('_');
            let formattedName = '';

            if (namePartsArray.length >= 2) {
                formattedName = `${namePartsArray[0]} ${namePartsArray[1]}`;
            } else {
                formattedName = namePartsArray[0] || 'Nom Inconnu';
            }
            
            formattedName = decodeURIComponent(formattedName).replace(/_/g, ' ').trim();

            const cardTypeMatch = filename.match(/_OVR_(.*?)\.webp/);
            const rawCardType = cardTypeMatch ? cardTypeMatch[1] : 'unknown';

            return { name: formattedName, ovr: ovr, rawCardType: rawCardType };
        }

        // Création de la carte pour l'interface de base
        function createCard(player) {
            const card = document.createElement('div');
            card.classList.add('card');
            card.setAttribute('data-id', player.id);

            const playerInfo = formatPlayerNameAndOVR(player.URL);

            card.innerHTML = `
                <img src="${player.URL}" alt="${playerInfo.name}" class="card-image">
                <div class="card-info">
                    <p class="player-name">${playerInfo.name}</p>
                    <p class="player-ovr">${playerInfo.ovr}</p>
                    <p class="card-type">Type de carte: ${formatCardType(player.cardType)}</p>
                </div>
            `;
            return card;
        }

        function formatCardType(cardType) {
            return cardType.replace(/_/g, ' ').replace(/\b\w/g, char => char.toUpperCase());
        }

        function displayNextCard() {
            if (swipeCounter >= currentSessionPlayers.length) {
                endRound();
                return;
            }

            if (currentPlayerIndex < currentSessionPlayers.length) {
                const player = currentSessionPlayers[currentPlayerIndex];
                const card = createCard(player);
                cardStack.appendChild(card);
                attachSwipeEvents(card);
                updateSwipeCount();

                // Précharge la prochaine image
                if (currentPlayerIndex + 1 < currentSessionPlayers.length) {
                    const nextPlayer = currentSessionPlayers[currentPlayerIndex + 1];
                    const img = new Image();
                    img.src = nextPlayer.URL;
                }
            } else {
                endRound();
            }
        }

        function updateSwipeCount() {
            swipeCounterTop.textContent = `${swipeCounter} / ${currentSessionPlayers.length}`;
        }

        function showSwipeMessage(type) {
            const message = type === 'like' ? likeMessage : nopeMessage;
            message.classList.add('visible');
            setTimeout(() => {
                message.classList.remove('visible');
            }, 800);
        }

        function performSwipe(direction) {
            const currentCard = cardStack.querySelector('.card');
            if (currentCard && !isSwiping) {
                dislikeBtn.disabled = true;
                likeBtn.disabled = true;

                swipeCard(currentCard, direction);

                // Ajout d'XP pour chaque swipe
                if (direction === 'right') { // C'est un "Like"
                    addXP(5); // Gagne 5 XP pour un Like
                } else { // C'est un "Nope"
                    addXP(1); // Gagne 1 XP pour un Nope
                }

                setTimeout(() => {
                    dislikeBtn.disabled = false;
                    likeBtn.disabled = false;
                }, 400);
            }
        }

        function swipeCard(card, direction) {
            card.style.transition = 'transform 0.4s ease-out, opacity 0.4s ease-out';
            if (direction === 'left') {
                card.style.transform = 'translateX(-150%) rotate(-30deg)';
                showSwipeMessage('nope');
            } else {
                card.style.transform = 'translateX(150%) rotate(30deg)';
                showSwipeMessage('like');
                const playerToLike = currentSessionPlayers[currentPlayerIndex];
                likedPlayersInSession.push(playerToLike);
                // Ajoute à la collection permanente si pas déjà présente
                if (!permanentCollection.some(p => p.id === playerToLike.id)) {
                    permanentCollection.push(playerToLike);
                    saveUserData(); // Sauvegarde la collection après chaque ajout
                }
            }
            card.style.opacity = '0';

            setTimeout(() => {
                card.remove();
                currentPlayerIndex++;
                swipeCounter++;
                displayNextCard();
            }, 400);
        }

        function endRound() {
            console.log("Fin du round ! Joueurs likés dans la session :", likedPlayersInSession);
            addXP(20); // Gagne 20 XP pour la fin de la série
            displayTeamModal();
        }

        function calculateTeamOverallRating() {
            if (likedPlayersInSession.length === 0) {
                return 0;
            }
            const totalOVR = likedPlayersInSession.reduce((sum, player) => sum + player.ovr, 0);
            return Math.round(totalOVR / likedPlayersInSession.length);
        }

        function displayPlayersInGrid(players, gridElement, countElement) {
            gridElement.innerHTML = '';
            
            if (players.length === 0) {
                gridElement.innerHTML = '<p style="grid-column: 1 / -1; margin-top: 50px;">Aucun joueur trouvé pour l\'instant !</p>';
                if (countElement) {
                    countElement.textContent = `Total de cartes : 0`;
                }
            } else {
                // Trie les joueurs pour la collection: par type de carte, puis par OVR (décroissant)
                const sortedPlayers = [...players].sort((a, b) => {
                    // Trier par type de carte (ordre alphabétique)
                    const typeComparison = a.cardType.localeCompare(b.cardType);
                    if (typeComparison !== 0) {
                        return typeComparison;
                    }
                    // Si le type de carte est le même, trier par OVR (décroissant)
                    return b.ovr - a.ovr;
                });

                sortedPlayers.forEach(player => {
                    const playerInfo = formatPlayerNameAndOVR(player.URL);
                    const playerCard = document.createElement('div');
                    playerCard.classList.add('team-player-card'); // Réutiliser la classe pour le style
                    playerCard.innerHTML = `
                        <img src="${player.URL}" alt="${playerInfo.name}">
                        <div class="player-details">
                            <p class="player-name-modal">${playerInfo.name}</p>
                            <p class="player-ovr">${playerInfo.ovr}</p>
                            <p class="card-type-modal">${formatCardType(player.cardType)}</p>
                        </div>
                    `;
                    gridElement.appendChild(playerCard);
                });
                if (countElement) {
                    countElement.textContent = `Total de cartes : ${players.length}`;
                }
            }
        }

        function displayTeamModal() {
            const overallRating = calculateTeamOverallRating();
            teamOverallRating.textContent = `Note Générale de l'Équipe: ${overallRating}`;
            displayPlayersInGrid(likedPlayersInSession, teamGrid); // Utilisez likedPlayersInSession ici
            teamModal.style.display = 'flex';
        }

        function displayCollectionModal() {
            // Pour la collection, on veut qu'elle soit triée et affichée sans titres de catégorie
            displayPlayersInGrid(permanentCollection, collectionGrid, collectionCountDisplay);
            collectionModal.style.display = 'flex';
        }

        // Refonte de startGame pour gérer la réinitialisation des joueurs likés de la session
        function startGame(resetLikedPlayers = true) {
            if (resetLikedPlayers) {
                likedPlayersInSession = []; // Réinitialise les joueurs likés de la session seulement si demandé
            }
            currentPlayerIndex = 0;
            swipeCounter = 0;
            cardStack.innerHTML = '';
            sideMenu.classList.remove('open');
            seriesSelectionModal.style.display = 'none';
            presetSelectionModal.style.display = 'none';
            ovrSelectionModal.style.display = 'none';
            teamModal.style.display = 'none';
            collectionModal.style.display = 'none';


            let playersToUse = allPlayersData;
            
            // Appliquer le filtre de preset (maintenant multiple)
            if (!selectedCardPresets.includes('all')) { 
                playersToUse = playersToUse.filter(player => selectedCardPresets.includes(player.cardType));
            }

            playersToUse = playersToUse.filter(player => {
                return player.ovr >= ovrFilterMin && player.ovr <= ovrFilterMax;
            });
            
            shuffleArray(playersToUse);
            currentSessionPlayers = playersToUse.slice(0, Math.min(MAX_SWIPES_PER_SESSION, playersToUse.length));
            
            updateSwipeCount();
            displayNextCard();
        }

        function resetAndStartGame() { // Utilisé pour "Nouvelle Partie" et filtres (réinitialise les joueurs likés)
            startGame(true); 
        }

        function refreshCurrentSeries() { // Nouvelle fonction pour le bouton d'actualisation (conserve les joueurs likés)
            startGame(false); 
            alert('Nouvelle série de cartes générée !');
        }


        // --- Gestion des événements de swipe (glisser-déposer) ---
        let startX;
        let currentX;
        let isSwiping = false;

        function attachSwipeEvents(card) {
            card.addEventListener('mousedown', (e) => {
                if (e.button !== 0) return;
                isSwiping = true;
                startX = e.clientX;
                card.style.transition = 'none';
            });

            document.addEventListener('mousemove', (e) => {
                if (!isSwiping) return;
                currentX = e.clientX;
                const deltaX = currentX - startX;
                card.style.transform = `translateX(${deltaX}px) rotate(${deltaX / 20}deg)`;

                if (deltaX > 50) {
                    likeMessage.classList.add('visible');
                    nopeMessage.classList.remove('visible');
                } else if (deltaX < -50) {
                    nopeMessage.classList.add('visible');
                    likeMessage.classList.remove('visible');
                } else {
                    likeMessage.classList.remove('visible');
                    nopeMessage.classList.remove('visible');
                }
            });

            document.addEventListener('mouseup', () => {
                if (!isSwiping) return;
                isSwiping = false;
                const deltaX = currentX - startX;

                likeMessage.classList.remove('visible');
                nopeMessage.classList.remove('visible');

                if (deltaX > 100) {
                    performSwipe('right');
                } else if (deltaX < -100) {
                    performSwipe('left');
                } else {
                    card.style.transition = 'transform 0.3s ease-out';
                    card.style.transform = 'translateX(0) rotate(0)';
                }
            });

            // Mobile - Tactile
            card.addEventListener('touchstart', (e) => {
                isSwiping = true;
                startX = e.touches[0].clientX;
                card.style.transition = 'none';
            });

            card.addEventListener('touchmove', (e) => {
                if (!isSwiping) return;
                currentX = e.touches[0].clientX;
                const deltaX = currentX - startX;
                card.style.transform = `translateX(${deltaX}px) rotate(${deltaX / 20}deg)`;

                if (deltaX > 50) {
                    likeMessage.classList.add('visible');
                    nopeMessage.classList.remove('visible');
                } else if (deltaX < -50) {
                    nopeMessage.classList.add('visible');
                    likeMessage.classList.remove('visible');
                } else {
                    likeMessage.classList.remove('visible');
                    nopeMessage.classList.remove('visible');
                }
            });

            card.addEventListener('touchend', () => {
                if (!isSwiping) return;
                isSwiping = false;
                const deltaX = currentX - startX;

                likeMessage.classList.remove('visible');
                nopeMessage.classList.remove('visible');

                if (deltaX > 100) {
                    performSwipe('right');
                } else if (deltaX < -100) {
                    performSwipe('left');
                } else {
                    card.style.transition = 'transform 0.3s ease-out';
                    card.style.transform = 'translateX(0) rotate(0)';
                }
            });
        }


        // --- Chargement des données et initialisation ---
        async function loadAllPlayers() {
            try {
                // Utiliser l'URL directe du fichier JSON sur GitHub
                const response = await fetch('https://raw.githubusercontent.com/Tristanox/FUT-25-assets/refs/heads/main/fut_25_images.json');
                const data = await response.json();

                cardTypesCount = { 'all': 0 };

                let tempMaxOVR = 0;
                let idCounter = 0;
                for (const cardType in data) {
                    cardTypesCount[cardType] = data[cardType].length;
                    data[cardType].forEach(player => {
                        const ovr = formatPlayerNameAndOVR(player.URL).ovr;
                        allPlayersData.push({
                            id: idCounter++, // Utiliser un ID unique pour chaque joueur
                            URL: player.URL,
                            cardType: cardType,
                            ovr: ovr
                        });
                        if (ovr > tempMaxOVR) {
                            tempMaxOVR = ovr;
                        }
                    });
                    cardTypesCount['all'] += data[cardType].length;
                }
                maxOVRFound = tempMaxOVR;
                ovrMaxRange.max = maxOVRFound;
                ovrMaxRange.value = maxOVRFound;
                updateOVRRangeDisplay();

                availableCardTypes = Object.keys(data);
                availableCardTypes.sort();
                availableCardTypes.unshift('all');

                loadUserData(); // <-- Charger les données de l'utilisateur ici
                startGame();
            } catch (error) {
                console.error("Erreur lors du chargement des joueurs :", error);
                document.body.innerHTML = "<p style='color: white; text-align: center; font-size: 1.5em; margin-top: 50px;'>Erreur : Impossible de charger les joueurs. Veuillez vérifier la connexion ou l'URL des assets.</p>";
            }
        }

        // --- Écouteurs d'événements pour les boutons Like/Dislike ---
        dislikeBtn.addEventListener('click', () => performSwipe('left'));
        likeBtn.addEventListener('click', () => performSwipe('right'));

        // --- Écouteurs d'événements pour le modal de réglage de série ---
        seriesRange.addEventListener('input', () => {
            let value = parseInt(seriesRange.value);
            // Ajustement pour les pas spécifiques (10, 50, 100)
            if (value <= 30) {
                value = 10;
            } else if (value > 30 && value <= 70) {
                value = 50;
            } else {
                value = 100;
            }
            seriesRange.value = value;
            sliderValueDisplay.textContent = value;
        });

        applySeriesLengthBtn.addEventListener('click', () => {
            MAX_SWIPES_PER_SESSION = parseInt(seriesRange.value);
            saveUserData(); 
            resetAndStartGame();
        });

        closeSeriesModalBtn.addEventListener('click', () => {
            seriesSelectionModal.style.display = 'none';
        });

        // Fermer le modal de l'équipe finale
        closeTeamModalBtn.addEventListener('click', () => {
            teamModal.style.display = 'none';
        });

        // Fermer le modal de la collection
        closeCollectionModalBtn.addEventListener('click', () => {
            collectionModal.style.display = 'none';
        });

        // Fermer les modals en cliquant en dehors (générique)
        window.addEventListener('click', (event) => {
            if (event.target == teamModal) {
                teamModal.style.display = 'none';
            }
            if (event.target == collectionModal) {
                collectionModal.style.display = 'none';
            }
            if (event.target == seriesSelectionModal) {
                seriesSelectionModal.style.display = 'none';
            }
            if (event.target == presetSelectionModal) {
                presetSelectionModal.style.display = 'none';
            }
            if (event.target == ovrSelectionModal) {
                ovrSelectionModal.style.display = 'none';
            }
        });

        // --- Gestion du menu Burger ---
        burgerMenuBtn.addEventListener('click', (event) => {
            event.stopPropagation();
            sideMenu.classList.add('open');
        });

        closeSideMenuBtn.addEventListener('click', () => {
            sideMenu.classList.remove('open');
        });

        resetGameMenuBtn.addEventListener('click', () => {
            selectedCardPresets = ['all']; // Réinitialiser le preset à 'all'
            ovrFilterMin = 64;
            ovrFilterMax = maxOVRFound;
            permanentCollection = []; 
            saveUserData(); 
            updateLevelDisplay(); 
            resetAndStartGame();
        });

        viewTeamMenuBtn.addEventListener('click', () => {
            sideMenu.classList.remove('open');
            displayTeamModal();
        });

        viewCollectionMenuBtn.addEventListener('click', () => { 
            sideMenu.classList.remove('open');
            displayCollectionModal();
        });

        changeSeriesLengthBtn.addEventListener('click', () => {
            sideMenu.classList.remove('open');
            seriesRange.value = MAX_SWIPES_PER_SESSION;
            sliderValueDisplay.textContent = MAX_SWIPES_PER_SESSION;
            seriesSelectionModal.style.display = 'flex';
        });

        choosePresetBtn.addEventListener('click', () => {
            sideMenu.classList.remove('open');
            populatePresetList(); // Popule les options AVANT d'afficher le modal
            presetSelectionModal.style.display = 'flex'; // Affiche le modal
        });

        closePresetModalBtn.addEventListener('click', () => {
            presetSelectionModal.style.display = 'none';
        });

        filterByOVRBtn.addEventListener('click', () => {
            sideMenu.classList.remove('open');
            ovrMinRange.value = ovrFilterMin;
            ovrMaxRange.value = ovrFilterMax;
            ovrMinRange.max = maxOVRFound;
            ovrMaxRange.max = maxOVRFound;
            updateOVRRangeDisplay();
            ovrSelectionModal.style.display = 'flex';
        });

        closeOvrModalBtn.addEventListener('click', () => {
            ovrSelectionModal.style.display = 'none';
        });

        ovrMinRange.addEventListener('input', () => {
            if (parseInt(ovrMinRange.value) > parseInt(ovrMaxRange.value)) {
                ovrMinRange.value = ovrMaxRange.value;
            }
            updateOVRRangeDisplay();
        });

        ovrMaxRange.addEventListener('input', () => {
            if (parseInt(ovrMaxRange.value) < parseInt(ovrMinRange.value)) {
                ovrMaxRange.value = ovrMinRange.value;
            }
            updateOVRRangeDisplay();
        });

        function updateOVRRangeDisplay() {
            ovrRangeValue.textContent = `${ovrMinRange.value} - ${ovrMaxRange.value}`;
        }

        applyOvrFilterBtn.addEventListener('click', () => {
            ovrFilterMin = parseInt(ovrMinRange.value);
            ovrFilterMax = parseInt(ovrMaxRange.value);
            saveUserData(); 
            resetAndStartGame();
        });


        // Fonction pour populer la liste des presets (maintenant avec checkboxes)
        function populatePresetList() {
            presetOptionsDiv.innerHTML = ''; // Nettoyer le conteneur
            availableCardTypes.forEach(type => {
                const itemDiv = document.createElement('div');
                itemDiv.classList.add('preset-option-item');

                const checkboxId = `preset-${type}`;
                const isChecked = selectedCardPresets.includes(type);
                
                // Création explicite des éléments
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = checkboxId;
                checkbox.value = type;
                checkbox.checked = isChecked;

                const label = document.createElement('label');
                label.htmlFor = checkboxId;
                label.innerHTML = `
                    <span>${type === 'all' ? 'Toutes les cartes' : formatCardType(type)}</span>
                    <span class="card-count">${cardTypesCount[type] || 0}</span>
                `;
                
                itemDiv.appendChild(checkbox);
                itemDiv.appendChild(label);
                
                if (isChecked) {
                    itemDiv.classList.add('selected');
                }

                presetOptionsDiv.appendChild(itemDiv);

                checkbox.addEventListener('change', () => {
                    if (checkbox.checked) {
                        itemDiv.classList.add('selected');
                    } else {
                        itemDiv.classList.remove('selected');
                    }
                    // Logique pour gérer la sélection "All cards"
                    if (type === 'all' && checkbox.checked) {
                        presetOptionsDiv.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                            if (cb.value !== 'all') {
                                cb.checked = false;
                                cb.closest('.preset-option-item').classList.remove('selected');
                            }
                        });
                    } else if (type !== 'all' && checkbox.checked) {
                        const allCheckbox = presetOptionsDiv.querySelector('#preset-all');
                        if (allCheckbox && allCheckbox.checked) {
                            allCheckbox.checked = false;
                            allCheckbox.closest('.preset-option-item').classList.remove('selected');
                        }
                    }
                });
                // Permettre de cliquer sur l'élément div pour basculer la checkbox
                itemDiv.addEventListener('click', (e) => {
                    if (e.target.tagName !== 'INPUT') { // Évite le double-clic si on clique directement sur la checkbox
                        checkbox.checked = !checkbox.checked;
                        checkbox.dispatchEvent(new Event('change')); // Déclenche l'événement change pour mettre à jour le style et la logique
                    }
                });
            });
            // L'écouteur du bouton "applyPresetFilterBtn" est déplacé à l'extérieur pour n'être attaché qu'une fois.
        }


        // --- Fonctions Export/Import des stats ---
        function exportUserData() {
            const dataToExport = {
                userLevel: userLevel,
                currentXP: currentXP,
                permanentCollection: permanentCollection,
                MAX_SWIPES_PER_SESSION: MAX_SWIPES_PER_SESSION,
                selectedCardPresets: selectedCardPresets, // Utiliser le nouveau nom de variable
                ovrFilterMin: ovrFilterMin,
                ovrFilterMax: ovrFilterMax
            };
            const jsonString = JSON.stringify(dataToExport, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'fut_swipe_stats.json';
            document.body.appendChild(a); 
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert('Vos stats ont été exportées en fut_swipe_stats.json !');
        }

        // Créer un input de type fichier masqué pour l'importation
        const importFileInput = document.createElement('input');
        importFileInput.type = 'file';
        importFileInput.accept = '.json';
        importFileInput.style.display = 'none';
        document.body.appendChild(importFileInput); 

        function importUserData() {
            importFileInput.click(); 
        }

        importFileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (typeof importedData.userLevel === 'number') userLevel = importedData.userLevel;
                    if (typeof importedData.currentXP === 'number') currentXP = importedData.currentXP;
                    if (Array.isArray(importedData.permanentCollection)) permanentCollection = importedData.permanentCollection;
                    if (typeof importedData.MAX_SWIPES_PER_SESSION === 'number') MAX_SWIPES_PER_SESSION = importedData.MAX_SWIPES_PER_SESSION;
                    
                    // Gérer l'importation de l'ancienne ou de la nouvelle structure de presets
                    if (Array.isArray(importedData.selectedCardPresets)) {
                        selectedCardPresets = importedData.selectedCardPresets;
                    } else if (typeof importedData.currentCardPreset === 'string') { // Compatibilité arrière
                        selectedCardPresets = [importedData.currentCardPreset];
                    } else {
                        selectedCardPresets = ['all']; // Valeur par défaut si inconnu
                    }

                    if (typeof importedData.ovrFilterMin === 'number') ovrFilterMin = importedData.ovrFilterMin;
                    if (typeof importedData.ovrFilterMax === 'number') ovrFilterMax = importedData.ovrFilterMax;

                    saveUserData(); 
                    updateLevelDisplay(); 
                    startGame(); 
                    alert('Vos stats ont été importées avec succès !');

                } catch (error) {
                    console.error('Erreur lors de l\'importation des stats:', error);
                    alert('Erreur lors de l\'importation. Le fichier n\'est pas un JSON valide ou est corrompu.');
                }
            };
            reader.readAsText(file);
            event.target.value = ''; 
        });

        // --- Écouteurs pour les nouveaux boutons d'action ---
        exportStatsBtn.addEventListener('click', exportUserData);
        importStatsBtn.addEventListener('click', importUserData);
        refreshSeriesBtn.addEventListener('click', refreshCurrentSeries); // Nouveau bouton d'actualisation

        // L'écouteur pour applyPresetFilterBtn est déplacé ici pour n'être attaché qu'une seule fois.
        applyPresetFilterBtn.addEventListener('click', () => {
            const selectedCheckboxes = presetOptionsDiv.querySelectorAll('input[type="checkbox"]:checked');
            selectedCardPresets = Array.from(selectedCheckboxes).map(cb => cb.value);

            if (selectedCardPresets.length === 0) {
                selectedCardPresets = ['all']; // Par défaut à 'all' si rien n'est sélectionné
                alert("Aucun type de carte sélectionné. 'Toutes les cartes' sera utilisé par défaut.");
            } else if (selectedCardPresets.includes('all') && selectedCardPresets.length > 1) {
                selectedCardPresets = ['all']; // Si 'all' est coché avec d'autres, seul 'all' est conservé
                alert("'Toutes les cartes' a été sélectionné, les autres sélections ont été ignorées.");
            }
            
            saveUserData();
            resetAndStartGame();
        });


        // Fermer le menu si on clique en dehors
        window.addEventListener('click', (event) => {
            if (!sideMenu.contains(event.target) && event.target !== burgerMenuBtn && !burgerMenuBtn.contains(event.target) && event.target !== exportStatsBtn && !exportStatsBtn.contains(event.target) && event.target !== importStatsBtn && !importStatsBtn.contains(event.target) && event.target !== refreshSeriesBtn && !refreshSeriesBtn.contains(event.target)) {
                sideMenu.classList.remove('open');
            }
        });

        // --- Écouteur d'événements pour les touches du clavier ---
        document.addEventListener('keydown', (e) => {
            if (teamModal.style.display === 'flex' || collectionModal.style.display === 'flex' || seriesSelectionModal.style.display === 'flex' || presetSelectionModal.style.display === 'flex' || ovrSelectionModal.style.display === 'flex' || sideMenu.classList.contains('open')) {
                return;
            }

            if (e.key === 'ArrowLeft') {
                performSwipe('left');
            } else if (e.key === 'ArrowRight') {
                performSwipe('right');
            }
        });

        // Initialisation au chargement de la page
        loadAllPlayers();
    </script>
</body>
</html>