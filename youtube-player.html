<!DOCTYPE html>
<html lang="fr"> <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecteur YouTube</title> <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #1E2124; /* Le plus sombre pour le fond */
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            color: #E0E0E0; /* Texte clair par d√©faut */
        }
        .main-content {
            display: flex;
            flex-direction: column; /* Organise le lecteur et l'historique en colonne */
            align-items: center; /* Centre le contenu dans cette colonne */
            gap: 20px;
            width: 100%;
            max-width: 1200px; /* Largeur maximale pour le contenu principal */
            justify-content: center;
        }
        .player-section {
            width: 100%; /* Prend toute la largeur disponible du main-content */
            max-width: 800px; /* Largeur maximale pour le lecteur */
            background-color: #282B30;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            text-align: center;
        }
        .history-section {
            width: 100%; /* Prend toute la largeur disponible du main-content */
            max-width: 400px; /* Largeur maximale pour l'historique */
            background-color: #282B30;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            overflow-y: auto; /* Permet le d√©filement si l'historique est long */
            max-height: 80vh; /* Hauteur maximale pour le d√©filement */
        }

        /* Conteneur unique pour les boutons de contr√¥le sous le lecteur */
        .player-controls-bottom {
            display: flex;
            flex-wrap: wrap; /* Permet aux boutons de passer √† la ligne sur petits √©crans */
            justify-content: center; /* Centre les boutons */
            gap: 10px; /* Espace entre les boutons */
            margin-top: 15px;
            width: 100%;
        }

        @media (max-width: 1024px) {
            .player-section {
                min-width: unset;
            }
            .history-section {
                margin-top: 20px;
                max-height: 40vh;
            }
        }

        h1 {
            color: #ff7575; /* CHANG√â DU VERT */
            margin-bottom: 25px;
            text-shadow: 0 0 5px rgba(255, 117, 117, 0.5); /* CHANG√â DU VERT */
        }
        h2 {
            color: #ff7575; /* CHANG√â DU VERT */
            margin-top: 0;
            margin-bottom: 15px;
            text-shadow: 0 0 3px rgba(255, 117, 117, 0.3); /* CHANG√â DU VERT */
        }
        .input-section {
            margin-bottom: 25px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        #youtubeLink {
            flex-grow: 1;
            padding: 10px 15px;
            border: 1px solid #36393E;
            border-radius: 5px;
            font-size: 1rem;
            min-width: 250px;
            background-color: #424549;
            color: #E0E0E0;
        }
        #youtubeLink::placeholder {
            color: #A0A0A0;
        }
        button {
            padding: 10px 20px;
            background-color: #ff7575; /* CHANG√â DU VERT */
            color: #1E2124;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease, transform 0.1s ease;
            white-space: nowrap; /* Emp√™che le texte de se casser */
        }
        button:hover {
            background-color: #ff9999; /* CHANG√â DU VERT, une teinte plus claire de #ff7575 */
            transform: translateY(-2px);
        }
        button:active {
            transform: translateY(0);
        }
        #player {
            width: 100%;
            aspect-ratio: 16 / 9;
            border: 2px solid #36393E;
            border-radius: 8px;
            background-color: #000;
            overflow: hidden;
            margin-bottom: 15px; /* Espace sous le lecteur */
        }
        .instructions {
            margin-top: 20px;
            font-size: 0.9em;
            color: #A0A0A0;
        }

        /* Historique */
        #historyList {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .history-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            background-color: #424549;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .history-item:hover {
            background-color: #36393E;
        }
        .history-item img {
            width: 80px;
            height: auto;
            border-radius: 3px;
        }
        .item-info {
            flex-grow: 1;
            text-align: left;
        }
        .item-info strong {
            display: block;
            color: #E0E0E0;
            font-size: 0.95em;
            line-height: 1.2;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <div class="main-content">
        <div class="player-section">
            <h1>Lecteur YouTube</h1>

            <div class="input-section">
                <input type="text" id="youtubeLink" placeholder="Collez le lien YouTube ou Playlist ici...">
                <button onclick="loadContent()">Charger</button>
            </div>

            <div id="player">
                </div>

            <div class="player-controls-bottom">
                <button onclick="shareVideo()">Partager üëÜ</button>

                <button id="previousButton" onclick="playPrevious()" style="display:none;">Pr√©c√©dent</button>
                <button id="nextButton" onclick="playNext()" style="display:none;">Suivant</button>
            </div>

            <p class="instructions">
                Collez l'URL compl√®te d'une vid√©o YouTube (ex. `https://www.youtube.com/watch?v=dQw4w9WgXcQ`) ou d'une playlist (ex. `https://www.youtube.com/playlist?list=PLrYd3Q7sA_GqP6J1W4R1QzK4V7z5w7vC8`) ou d'un live.
            </p>
        </div>

        <div class="history-section">
            <h2>Historique des vid√©os</h2>
            <ul id="historyList">
                <p style="color:#A0A0A0; font-size:0.85em;">Chargement de l'historique...</p>
            </ul>
        </div>
    </div>

    <script>
        let player; // Variable globale pour le lecteur YouTube
        let currentVideoId = ''; // Garde en m√©moire l'ID de la vid√©o actuelle
        let currentPlaylistId = ''; // Garde en m√©moire l'ID de la playlist actuelle

        const HISTORY_KEY = 'youtube_player_history';
        const MAX_HISTORY_ITEMS = 10; // Nombre maximum d'√©l√©ments dans l'historique

        // --- Votre CL√â D'API YouTube Data v3 ---
        // IMPORTANT : Remplacez 'VOTRE_CLE_API_YOUTUBE' par votre vraie cl√© d'API.
        // Pour l'obtenir : console.cloud.google.com -> API & Services -> Biblioth√®que -> Rechercher "YouTube Data API v3" et l'activer.
        // Puis : API & Services -> Identifiants -> Cr√©er des identifiants -> Cl√© API.
        const API_KEY = 'VOTRE_CLE_API_YOUTUBE'; 

        // --- Fonctions de l'API YouTube Player ---

        // Fonction appel√©e lorsque l'API YouTube est pr√™te
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '360',
                width: '640',
                videoId: '', // Pas de vid√©o au d√©marrage
                playerVars: {
                    'playsinline': 1,
                    'autoplay': 0,
                    'modestbranding': 1,
                    'rel': 0,
                    'controls': 1
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange,
                    'onError': onPlayerError // G√©rer les erreurs du lecteur
                }
            });
        }

        function onPlayerReady(event) {
            console.log("Lecteur YouTube pr√™t !");
            loadHistory(); // Charge l'historique au d√©marrage

            // Tente de charger du contenu (vid√©o ou playlist) depuis les param√®tres d'URL
            const urlParams = new URLSearchParams(window.location.search);
            const videoIdFromUrl = urlParams.get('v');
            const playlistIdFromUrl = urlParams.get('list');

            if (playlistIdFromUrl) {
                loadPlaylistById(playlistIdFromUrl);
            } else if (videoIdFromUrl) {
                loadVideoById(videoIdFromUrl);
            }
        }

        function onPlayerStateChange(event) {
            // Mettre √† jour l'historique uniquement quand une nouvelle vid√©o commence √† jouer
            if (event.data === YT.PlayerState.PLAYING) {
                const videoData = player.getVideoData();
                const videoId = videoData.video_id;

                if (videoId && videoId !== currentVideoId) { // V√©rifie si l'ID a chang√©
                    currentVideoId = videoId;
                    addToHistory(videoId);
                }
            }
        }

        function onPlayerError(event) {
            let errorMessage = "Une erreur est survenue lors de la lecture de la vid√©o.";
            switch (event.data) {
                case 2:
                    errorMessage = "ID de vid√©o invalide ou contient des caract√®res non pris en charge. V√©rifiez le lien.";
                    break;
                case 5:
                    errorMessage = "Erreur HTML5, la vid√©o n'a pas pu √™tre lue.";
                    break;
                case 100:
                    errorMessage = "Vid√©o introuvable, priv√©e ou supprim√©e.";
                    break;
                case 101:
                case 150:
                    errorMessage = "L'int√©gration de la vid√©o n'est pas autoris√©e par le propri√©taire.";
                    break;
            }
            alert(errorMessage + " (Code: " + event.data + ")");
            console.error("Erreur du lecteur YouTube :", event.data, player.getVideoUrl());
        }

        // --- Gestion de l'historique ---

        function getHistory() {
            const historyJson = localStorage.getItem(HISTORY_KEY);
            return historyJson ? JSON.parse(historyJson) : [];
        }

        function saveHistory(history) {
            localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
        }

        async function addToHistory(videoId) {
            if (API_KEY === 'VOTRE_CLE_API_YOUTUBE' || API_KEY.length < 20) {
                 console.error("ERREUR CL√â API: L'historique ne peut pas afficher les titres/miniatures sans une cl√© d'API YouTube Data v3 valide.");
                 return;
            }

            const videoDetails = await fetchVideoDetails(videoId);
            if (videoDetails) {
                let history = getHistory();
                // Supprime l'ancienne entr√©e si la vid√©o est d√©j√† dans l'historique
                history = history.filter(item => item.id !== videoId);
                // Ajoute la nouvelle vid√©o au d√©but
                history.unshift({
                    id: videoId,
                    title: videoDetails.title,
                    thumbnailUrl: videoDetails.thumbnailUrl
                });
                // Limite la taille de l'historique
                if (history.length > MAX_HISTORY_ITEMS) {
                    history = history.slice(0, MAX_HISTORY_ITEMS);
                }
                saveHistory(history);
                displayHistory(); // Rafra√Æchit l'affichage
            } else {
                console.error("Impossible d'ajouter √† l'historique: d√©tails vid√©o non trouv√©s pour", videoId);
            }
        }

        function displayHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = ''; // Vide l'historique actuel

            const history = getHistory();
            if (history.length === 0) {
                const p = document.createElement('p');
                p.style.color = '#A0A0A0';
                p.style.fontSize = '0.85em';
                p.textContent = 'Aucune vid√©o regard√©e pour l\'instant.';
                historyList.appendChild(p);
                return;
            }

            history.forEach(video => {
                const li = document.createElement('li');
                li.className = 'history-item';
                li.innerHTML = `
                    <img src="${video.thumbnailUrl}" alt="${video.title || 'Miniature vid√©o'}">
                    <div class="item-info">
                        <strong>${video.title || 'Titre inconnu'}</strong>
                    </div>
                `;
                li.onclick = () => {
                    currentPlaylistId = ''; // Efface le contexte de playlist
                    // Masque les boutons Pr√©c√©dent/Suivant car on n'est plus en mode playlist
                    document.getElementById('previousButton').style.display = 'none';
                    document.getElementById('nextButton').style.display = 'none';
                    loadVideoById(video.id);
                };
                historyList.appendChild(li);
            });
        }

        function loadHistory() {
            displayHistory(); // Affiche l'historique au chargement de la page
        }

        // --- Fonctions de chargement et d'extraction ---

        function getYouTubeId(url) {
            let videoId = null;
            let playlistId = null;

            // Regex pour vid√©os standard et lives
            const videoRegex = /(?:https?:\/\/)?(?:www\.)?(?:m\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=|embed\/|v\/|)([\w-]{11})(?:\S+)?/i;
            const videoMatch = url.match(videoRegex);
            if (videoMatch && videoMatch[1]) {
                videoId = videoMatch[1];
            }

            // Regex pour playlists
            const playlistRegex = /[?&]list=([a-zA-Z0-9_-]+)/i;
            const playlistMatch = url.match(playlistRegex);
            if (playlistMatch && playlistMatch[1]) {
                playlistId = playlistMatch[1];
            }

            return { videoId, playlistId };
        }

        // Charge le contenu (vid√©o ou playlist) √† partir de l'input
        async function loadContent() {
            const linkInput = document.getElementById('youtubeLink');
            const url = linkInput.value.trim();

            if (!url) {
                alert("Veuillez coller un lien YouTube ou de playlist.");
                return;
            }

            const { videoId, playlistId } = getYouTubeId(url);

            if (playlistId) {
                loadPlaylistById(playlistId);
            } else if (videoId) {
                loadVideoById(videoId);
            } else {
                alert("Lien YouTube ou de playlist invalide. Veuillez coller un lien correct.");
            }
            linkInput.value = ''; // Efface le champ apr√®s chargement
        }

        // Charge une vid√©o par son ID
        function loadVideoById(videoId) {
            if (player) {
                player.loadVideoById(videoId);
                currentVideoId = videoId;
                currentPlaylistId = ''; // Efface le contexte de playlist
                // Masque les boutons Pr√©c√©dent/Suivant si on charge une vid√©o unique
                document.getElementById('previousButton').style.display = 'none';
                document.getElementById('nextButton').style.display = 'none';
            } else {
                player = new YT.Player('player', {
                    height: '360',
                    width: '640',
                    videoId: videoId,
                    playerVars: {
                        'playsinline': 1,
                        'autoplay': 1
                    },
                    events: {
                        'onReady': (event) => {
                            event.target.playVideo();
                            currentVideoId = videoId;
                            currentPlaylistId = '';
                            document.getElementById('previousButton').style.display = 'none';
                            document.getElementById('nextButton').style.display = 'none';
                        },
                        'onStateChange': onPlayerStateChange,
                        'onError': onPlayerError
                    }
                });
            }
        }

        // Charge une playlist par son ID
        function loadPlaylistById(playlistId) {
            if (player) {
                player.loadPlaylist({
                    list: playlistId,
                    listType: 'playlist',
                    index: 0, // Commence par la premi√®re vid√©o de la playlist
                    startSeconds: 0
                });
                currentPlaylistId = playlistId;
                currentVideoId = ''; // Efface l'ID de vid√©o quand une playlist est charg√©e
                // Affiche les boutons Pr√©c√©dent/Suivant
                document.getElementById('previousButton').style.display = 'inline-block';
                document.getElementById('nextButton').style.display = 'inline-block';

                // Message temporaire dans l'historique
                const historyList = document.getElementById('historyList');
                historyList.innerHTML = '';
                const p = document.createElement('p');
                p.style.color = '#A0A0A0';
                p.style.fontSize = '0.85em';
                p.textContent = 'Playlist charg√©e. Utilisez les contr√¥les du lecteur ou les boutons Pr√©c√©dent/Suivant.';
                historyList.appendChild(p);

            } else {
                player = new YT.Player('player', {
                    height: '360',
                    width: '640',
                    playerVars: {
                        'listType': 'playlist',
                        'list': playlistId,
                        'playsinline': 1,
                        'autoplay': 1
                    },
                    events: {
                        'onReady': (event) => {
                            event.target.playVideo();
                            currentPlaylistId = playlistId;
                            currentVideoId = '';
                            document.getElementById('previousButton').style.display = 'inline-block';
                            document.getElementById('nextButton').style.display = 'inline-block';
                        },
                        'onStateChange': onPlayerStateChange,
                        'onError': onPlayerError
                    }
                });
            }
        }

        function playPrevious() {
            if (player && currentPlaylistId) {
                player.previousVideo();
            }
        }

        function playNext() {
            if (player && currentPlaylistId) {
                player.nextVideo();
            }
        }


        // --- Fonctionnalit√©s Partager ---

        function shareVideo() {
            let shareUrl = '';
            if (currentPlaylistId) {
                shareUrl = `${window.location.origin}${window.location.pathname}?list=${currentPlaylistId}`;
            } else if (currentVideoId) {
                shareUrl = `${window.location.origin}${window.location.pathname}?v=${currentVideoId}`;
            }

            if (shareUrl) {
                navigator.clipboard.writeText(shareUrl).then(() => {
                    alert("Lien copi√© dans le presse-papiers !");
                }).catch(err => {
                    console.error('Erreur lors de la copie du lien: ', err);
                    alert("Impossible de copier le lien. Veuillez copier manuellement : " + shareUrl);
                });
            } else {
                alert("Aucun contenu charg√© √† partager.");
            }
        }

        // R√©cup√®re les d√©tails d'une vid√©o via l'API YouTube Data v3 (utilis√© pour l'historique)
        async function fetchVideoDetails(videoId) {
            if (API_KEY === 'VOTRE_CLE_API_YOUTUBE' || API_KEY.length < 20) {
                 console.error("ERREUR CL√â API: Impossible de r√©cup√©rer les d√©tails de la vid√©o (pour l'historique) sans une cl√© d'API YouTube Data v3 valide.");
                 return null;
            }

            const apiUrl = `https://www.googleapis.com/youtube/v3/videos?id=${videoId}&part=snippet&key=${API_KEY}`; // 'statistics' removed as it's not displayed

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    const errorData = await response.json();
                    console.error("Erreur HTTP de l'API YouTube Data:", response.status, errorData);
                    return null;
                }
                const data = await response.json();

                if (data.items && data.items.length > 0) {
                    const item = data.items[0].snippet;
                    return {
                        id: videoId,
                        title: item.title,
                        thumbnailUrl: item.thumbnails.medium ? item.thumbnails.medium.url : `https://i.ytimg.com/vi/${videoId}/mqdefault.jpg` // Fallback miniature
                    };
                }
                console.warn("Vid√©o non trouv√©e via l'API Data pour l'ID :", videoId);
                return null;
            } catch (error) {
                console.error("Erreur lors de la r√©cup√©ration des d√©tails de la vid√©o via API :", error);
                return null;
            }
        }

        // --- Initialisation ---

        // Charge l'API IFrame Player de YouTube de mani√®re asynchrone
        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api"; // URL standard et correcte de l'API YouTube
        const firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // Au chargement initial de la page
        document.addEventListener('DOMContentLoaded', () => {
            const linkInput = document.getElementById('youtubeLink');
            linkInput.addEventListener('paste', (event) => {
                // Laisse le navigateur coller le texte, puis charge le contenu
                setTimeout(() => {
                    loadContent();
                }, 100);
            });
        });
    </script>
</body>
</html>