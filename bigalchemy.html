<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Little Alchemy Clone - Fusion Al√©atoire</title>
  <style>
    :root {
      /* Couleurs pour le mode clair (contraste augment√©) */
      --bg-color-light: #e6e6e6;
      --sidebar-bg-light: #f5f5f5;
      --workspace-bg-light: #d0d0d0;
      --element-bg-light: #6A9BFF;
      --floating-bg-light: #ffe0a0;

      /* Couleurs pour le mode sombre (adapt√©es avec le nouveau bleu fonc√©) */
      --bg-color-dark: #121212;
      --sidebar-bg-dark: #1e1e1e;
      --workspace-bg-dark: #2c2c2c;
      --element-bg-dark: #4C75BF;
      --floating-bg-dark: #4C75BF;

      --glow-color: #3fe03f;
      --transition-speed: 0.3s;
    }

    body {
      font-family: sans-serif;
      margin: 0;
      display: flex;
      height: 100vh;
      background: var(--bg-color-light);
      color: #111;
      transition: background var(--transition-speed), color var(--transition-speed);
    }
    body.dark {
      background: var(--bg-color-dark);
      color: #eee;
    }

    #fixed-controls {
      position: fixed;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 10px;
      z-index: 100;
    }

    #themeToggle, #cleanWorkspaceBtn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      font-size: 1.2em;
      background-color: white;
      color: #333;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease;
      user-select: none;
    }
    #themeToggle:hover, #cleanWorkspaceBtn:hover {
      transform: scale(1.1);
    }
    #themeToggle:active, #cleanWorkspaceBtn:active, #sort-buttons button:active {
        transform: scale(0.95);
        transition: transform 0.1s ease;
    }

    body.dark #themeToggle,
    body.dark #cleanWorkspaceBtn {
      background-color: #333;
      color: white;
    }

    #sidebar {
      width: 250px;
      background: var(--sidebar-bg-light);
      padding: 10px;
      overflow-y: hidden; /* Chang√© pour cacher le d√©bordement vertical */
      border-right: 1px solid #ccc;
      display: flex;
      flex-direction: column;
      transition: background var(--transition-speed), color var(--transition-speed);
    }
    body.dark #sidebar {
      background: var(--sidebar-bg-dark);
      border-color: #444;
      color: #ccc;
    }

    #tab-container {
      display: flex;
      border-bottom: 1px solid #ccc;
      margin-bottom: 10px;
      flex-shrink: 0; /* Emp√™che les onglets de r√©tr√©cir */
    }
    body.dark #tab-container {
      border-color: #444;
    }
    .tab-button {
      flex: 1;
      padding: 10px;
      border: none;
      background: none;
      cursor: pointer;
      font-size: 1em;
      color: #666;
      transition: color 0.3s, border-bottom 0.3s;
      border-bottom: 3px solid transparent;
    }
    body.dark .tab-button {
      color: #888;
    }
    .tab-button.active {
      color: #111;
      font-weight: bold;
      border-bottom: 3px solid var(--element-bg-light);
    }
    body.dark .tab-button.active {
      color: #eee;
      border-bottom-color: var(--element-bg-dark);
    }

    #search {
      margin-top: 10px; /* Ajust√© pour √™tre apr√®s les listes */
      padding: 5px;
      border-radius: 4px;
      border: 1px solid #ccc;
      transition: background var(--transition-speed), color var(--transition-speed), border-color var(--transition-speed), box-shadow 0.2s ease;
      background: #fff;
      color: #000;
      flex-shrink: 0;
    }
    #search:hover {
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.2);
      border-color: #666;
    }
    body.dark #search {
      background: #222;
      color: #ddd;
      border-color: #555;
    }
    body.dark #search:hover {
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.1);
      border-color: #888;
    }

    #sort-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 10px;
      margin-bottom: 10px;
      flex-shrink: 0;
    }
    #sort-buttons button {
      flex: 1;
      min-width: 80px;
      padding: 5px 8px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.85em;
      background: #4A6B7F;
      color: white;
      transition: background 0.3s ease, transform 0.2s ease;
    }
    #sort-buttons button:hover {
      background: #3B5B6F;
      transform: translateY(-1px);
    }
    body.dark #sort-buttons button {
      background: #3A3A3A;
    }
    body.dark #sort-buttons button:hover {
      background: #4A4A4A;
    }
    #sort-buttons button.active {
      background: #3fe03f;
      font-weight: bold;
      color: #222;
    }
    body.dark #sort-buttons button.active {
      background: #3fe03f;
      color: #222;
    }
    
    .list-container {
        flex: 1; /* Permet au conteneur de prendre l'espace restant */
        overflow-y: auto; /* Ajoute une barre de d√©filement si n√©cessaire */
        min-height: 0; /* Essentiel pour que flexbox fonctionne correctement */
    }

    #elements-list, #undiscovered-list {
      user-select:none;
    }
    #undiscovered-list {
        display: none;
    }

    .undiscovered-element {
        filter: grayscale(1);
        opacity: 0.6;
        cursor: default;
        pointer-events: none;
    }

    #workspace {
      flex: 1;
      position: relative;
      background: var(--workspace-bg-light);
      transition: background var(--transition-speed);
      overflow: hidden;
    }
    body.dark #workspace {
      background: var(--workspace-bg-dark);
    }

    canvas#backgroundCanvas, canvas#constellationCanvas {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    .element {
      display: inline-block;
      padding: 5px 10px;
      margin: 5px;
      background: var(--element-bg-light);
      border-radius: 8px;
      cursor: pointer;
      user-select: none;
      transition: background var(--transition-speed), color var(--transition-speed), box-shadow 0.2s ease, text-shadow 0.2s ease, transform 0.2s ease;
      color: #000;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.4);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
      position: relative;
      z-index: 1;
    }
    .element:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    body.dark .element {
      background: var(--element-bg-dark);
      color: #eee;
      box-shadow: 0 3px 8px rgba(0,0,0,0.8), inset 0 1px 0 rgba(255,255,255,0.1);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.4);
    }
    body.dark .element:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0,0,0,0.9);
    }
    .element:active {
      cursor: grabbing;
    }
    
    .floating-element {
      position: absolute;
      padding: 5px 10px;
      background: var(--floating-bg-light);
      border: 1px solid #aaa;
      border-radius: 5px;
      cursor: move;
      user-select: none;
      white-space: nowrap;
      transition:
        transform var(--transition-speed) ease,
        opacity var(--transition-speed) ease,
        box-shadow 0.2s ease,
        background var(--transition-speed),
        border-color var(--transition-speed),
        color var(--transition-speed),
        text-shadow 0.2s ease;
      box-shadow: 0 3px 6px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.5);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.15);
      color: #000;
      z-index: 1;
    }
    .floating-element:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 10px rgba(0,0,0,0.4);
    }
    body.dark .floating-element {
      background: var(--floating-bg-dark);
      border-color: var(--floating-bg-dark);
      color: #e0eaff;
      box-shadow: 0 4px 10px rgba(0,0,0,0.9), inset 0 1px 0 rgba(255,255,255,0.15);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }
    body.dark .floating-element:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0,0,0,0.95);
    }

    .combine-animation { animation: pop 0.4s ease forwards; }
    .glow { box-shadow: 0 0 12px 4px var(--glow-color); border-color: var(--glow-color); transition: box-shadow 0.2s ease, border-color 0.2s ease; }
    .can-combine-glow { box-shadow: 0 0 15px 5px var(--glow-color); border-color: var(--glow-color); transition: box-shadow 0.15s ease, border-color 0.15s ease; }
    @keyframes pop { 0% { transform: scale(0); opacity: 0; } 50% { transform: scale(1.2); opacity: 1; } 100% { transform: scale(1); } }
    @keyframes fadeOutAndShrink { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(0.5); } }
    .disappear-animation { animation: fadeOutAndShrink 0.3s ease-out forwards; pointer-events: none; }
    @keyframes newElementHighlight { 0% { transform: scale(1); box-shadow: 0 0 0 0 transparent; background-color: inherit; } 25% { transform: scale(1.15); box-shadow: 0 0 25px 8px var(--glow-color); background-color: var(--glow-color); color: #222; } 75% { transform: scale(1.05); box-shadow: 0 0 10px 4px var(--glow-color); } 100% { transform: scale(1); box-shadow: initial; background-color: inherit; color: inherit; } }
    .new-element-animation { animation: newElementHighlight 1s ease-out; }
    @keyframes fadeInScale { 0% { opacity: 0; transform: scale(0.9); } 100% { opacity: 1; transform: scale(1); } }
    .element.animate-in { animation: fadeInScale 0.3s ease-out forwards; }
  </style>
</head>
<body class="dark">
  <div id="fixed-controls">
    <button id="cleanWorkspaceBtn">üßπ</button>
    <button id="themeToggle"></button>
  </div>

  <div id="sidebar">
    <div id="tab-container">
        <button id="tab-discovered" class="tab-button active">D√©couverts</button>
        <button id="tab-undiscovered" class="tab-button">√Ä d√©couvrir</button>
    </div>

    <div class="list-container">
        <div id="elements-list"></div>
        <div id="undiscovered-list"></div>
    </div>
    
    <div id="sort-buttons">
        <button id="sortByAge" class="active">Par √Çge</button>
        <button id="sortByName">Par Nom</button>
        <button id="sortByEmoji">Par Emoji</button>
        <button id="sortByRandom">Al√©atoire</button>
    </div>
    <input id="search" type="text" placeholder="üîç Rechercher..." autocomplete="off" />
  </div>

  <div id="workspace">
    <canvas id="backgroundCanvas"></canvas>
    <canvas id="constellationCanvas"></canvas>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      
      const recipes = {};
      const emojis = {};
      let allElementNames = [];

      // --- CORRECTION : Voici la liste COMPL√àTE de vos √©l√©ments ---
      const elementsJsonContent = [
        "üß¨ADN","üß≤aimant","‚úàÔ∏èavion","üí°ampoule","üß°ambre","üíúam√©thyste","üêúfourmi","üß≠boussole","üèπchasse","üèõÔ∏ètemple","‚õ∫camping","üöóconduite","‚öôÔ∏èengrenage","ü™ìhache","üê¥crin","üêÉcorne","üêòivoire","üê¢√©caille","üíÄos","ü©∏sang","ü•õlait","üßàgraisse","ü•©viande","üêüpoisson","üßπpoussi√®re","‚ö™chaux","üå≥mousse","üçÑlichen","üåøalgue","üî¨plancton","üçΩÔ∏ènutriment","üç¨sucre","üßÇsel","üå∂Ô∏è√©pice","üç∂huile","üß™vinaigre","üç∑alcool","üçûlevure","ü¶†bact√©rie","ü¶†virus","üß¨g√®ne","üî¨prot√©ine","üß™acide","üß™base","üß™solution","‚öóÔ∏èm√©lange","üí®gaz","üíßliquide","üß±solide","‚ú®plasma","üååvide","‚è≥temps","üåêespace","‚úäforce","üéØpression","üå°Ô∏ètemp√©rature","üîäson","üåülumi√®re","üåëombre","üé®couleur","üëÉodeur","üëÖgo√ªt","‚úãtoucher","üëÄvision","üëÇou√Øe","üëÉodorat","ü§∏√©quilibre","ü§ïdouleur","üòäplaisir","ü§îconscience","üß†pens√©e","üí°m√©moire","üò¥r√™ve","üëªesprit","üôè√¢me","üö∂corps","üíñvie","üíÄmort","üë∂naissance","üå±croissance","üìà√©volution","üîÑchangement","üèÉmouvement","üßòrepos","üíºtravail","‚ö°√©nergie","üöÄvitesse","üìèdistance","‚öñÔ∏èmasse","üè∫volume","‚öñÔ∏èdensit√©","‚öñÔ∏èpoids","‚ô®Ô∏èchaleur","ü•∂froid","„Ä∞Ô∏èonde","‚öõÔ∏èparticule","‚öõÔ∏èatome","‚öõÔ∏èmol√©cule","üî¨cellule","ü©∏tissu","üß°organe","‚öôÔ∏èsyst√®me","üåøorganisme","üêæesp√®ce","üë•population","üå≤√©cosyst√®me","üåçbiosph√®re","ü™êplan√®te","üí´cosmos","üååunivers","ü™®ardoise","üíéopale","üî∂topaze","üíôsaphir","üíö√©meraude","üî¥rubis","üü°citrine","‚ö™zircon","üñ§onyx","‚ö™nacre","ü¶∑d√©fense","ü¶¥phalange","ü¶¥vert√®bre","ü¶¥cr√¢ne","ü¶¥m√¢choire","ü¶¥clavicule","ü¶¥c√¥te","ü¶¥tibia","ü¶¥f√©mur","üß¨cartilage","üíÖk√©ratine","ü¶∑√©mail","ü¶∑dentine","ü¶∑pulpe","ü™µ√©corce","üå≥rameau","üå≤tronc","üå≥racine","ü™µsouche","ü™µplanche","ü™µpoutre","ü™µcopeau","ü™µsciure","ü™µb√ªche","ü™µsarment","ü™öli√®ge","üß∫osier","üéãroseau","üåæpaille","üåæfoin","üåæson","üåæfarine","üçûlevain","üçûmie","üçûcro√ªte","üçöamidon","üçögrain","üç¨sirop","üçÆm√©lasse","üçØnectar","üçØpollen","üêùruche","ü™±ver","üêõchenille","ü¶ãchrysalide","ü¶ãpapillon","ü¶ócriquet","üêûcoccinelle","üï∑Ô∏èaraign√©e","ü¶Çscorpion","ü¶ümoustique","ü™∞mouche","ü™≤scarab√©e","ü¶ócigale","ü¶ógrillon","üêåescargot","ü¶™moule","ü¶™hu√Ætre","ü¶ûcrabe","ü¶êcrevette","ü¶ëcalamar","üêôpieuvre","üê†nageoire","üê†√©caille","ü¶àaileron","üê°poisson","üê¨dauphin","üê≥baleine","üêäreptile","üêçserpent","ü¶él√©zard","üê¢tortue","üê∏grenouille","üê•oisillon","üê£poussin","ü•öcoque","ü•öblanc","ü•öjaune","ü¶¢duvet","üêìcr√™te","üêìbarbillon","üêìplume","üêàpoil","üêïmue","üêëtoison","üêêcorne","üê¥sabot","üêÑpis","üêñlard","ü•©filet","ü•©c√¥te","ü•©gigot","ü•©jarret","üçócuisse","üçópoitrine","ü•ìbacon","üå≠saucisse","üçïjambon","üßÇsaumure","üç∂laiton","üî©boulon","üß≤aimant","üí°bobine","üîåfil","‚ö°circuit","üîådiode","üíªpuce","üì°antenne","üì°onde","üìªradio","üì∫√©cran","üî¶lampe","üí°ampoule","üîåc√¢ble","‚õìÔ∏ècha√Æne","üîómaillon","ü™¢n≈ìud","üéóÔ∏èruban","üß£√©charpe","üß§gant","üß¶chaussette","üëömanche","üëñjambe","üëójupe","üß•col","üëïbouton","üëïfermeture","üéíbretelle","üëõfermoir","üîëserrure","üö™charni√®re","ü™üvitre","üß±brique","ü™®moellon","ü™®granulat","ü™®pav√©","ü™®dallage","ü™®tuile","ü™®bardeaux","ü™öplanche","ü™öpoutre","ü™öchevrons","üî©vis","üî®clou","üî©√©crou","üî®rondelle","üî®rivet","üî®goujon","üî®goupille","ü™õtournevis","üîßcl√©","ü™öscie","ü™ìhache","‚õèÔ∏èpelle","‚õèÔ∏èpioche","‚õèÔ∏èmarteau","ü™örabot","ü™õburin","ü™õciseau","ü™õlime","ü™õr√¢pe","ü™õ√©tau","ü™õperceuse","ü™õforet","‚öôÔ∏èmoteur","‚öôÔ∏èroue","‚öôÔ∏èessieu","‚öôÔ∏èpiston","‚öôÔ∏ècylindre","‚öôÔ∏èarbre","‚öôÔ∏èpalier","‚öôÔ∏èressort","‚öôÔ∏èfrein","‚öôÔ∏èembrayage","‚öôÔ∏èradiateur","‚öôÔ∏ècarburateur","‚öôÔ∏èinjecteur","‚öôÔ∏èpompe","‚öôÔ∏èvalve","‚öôÔ∏èjoint","‚öôÔ∏èturbine","‚öôÔ∏èh√©lice","‚öôÔ∏èr√©acteur","‚öôÔ∏èpropulseur","‚öôÔ∏èfus√©e","üöÄsatelite","üõ∞Ô∏èsonde","üî≠t√©lescope","üî¨microscope","‚öñÔ∏èbalance","üìèm√®tre","üìêr√®gle","üìêcompas","üìê√©querre","üßÆcalculatrice","üßÆordinateur","üñ•Ô∏èclavier","üñ±Ô∏èsouris","üñ®Ô∏èimprimante","‚öôÔ∏èprocesseur","üíæm√©moire","üíødisque","üì°routeur","üåêinternet","‚òÅÔ∏ècloud","üíæfichier","üìÑdocument","üñºÔ∏èimage","üé∂son","üé¨vid√©o","üìßemail","üí¨message","üìûappel","üó£Ô∏èvoix","üó£Ô∏èparole","üëÇ√©coute","üëÅÔ∏èregard","üëÉrespiration","üëÖgustation","üñêÔ∏èsensation","üß†intuition","üß†raison","üß†logique","üß†cr√©ativit√©","üß†imagination","üß†m√©moire","üß†apprentissage","üß†sagesse","üß†connaissance","üß†compr√©hension","üß†intelligence","üß†r√©flexion","üß†conscience","üß†subconscient","üß†inconscient","üí≠r√™ve","üåôsommeil","‚òÄÔ∏è√©veil","üö∂marche","üèÉcourse","ü§∏saut","üèänage","üö¥v√©lo","üöóconduite","‚úàÔ∏èvol","üöÄpropulsion","‚öìancre","üó∫Ô∏ècarte","üìçpoint","üìèligne","üìêangle","üìêcourbe","üìêcercle","üìêspirale","üìêtriangle","üìêcarr√©","üìêrectangle","üìêpolygone","üìêsph√®re","üìêcube","üìêc√¥ne","üìêcylindre","üìêpyramide","üìêprisme","üìêtore","‚öõÔ∏èquantum","‚öõÔ∏èphoton","‚öõÔ∏è√©lectron","‚öõÔ∏èproton","‚öõÔ∏èneutron","‚öõÔ∏ènoyau","‚öõÔ∏èquarks","‚öõÔ∏èleptons","‚öõÔ∏èbosons","‚öõÔ∏èfermions","‚öõÔ∏ègraviton","‚öõÔ∏ègluon","‚öõÔ∏èonde","‚öõÔ∏èchamp","‚öõÔ∏èforce","‚öõÔ∏ègravit√©","‚öõÔ∏è√©lectromagn√©tisme","‚öõÔ∏ènucl√©aire","‚öõÔ∏èfaible","‚öõÔ∏èfort","‚öõÔ∏ètemp√©rature","‚öõÔ∏èpression","‚öõÔ∏èdensit√©","‚öõÔ∏èviscosit√©","‚öõÔ∏èconductivit√©","‚öõÔ∏èr√©sistivit√©","‚öõÔ∏èr√©fraction","‚öõÔ∏èr√©flexion","‚öõÔ∏èabsorption","‚öõÔ∏è√©mission","‚öõÔ∏èdiffusion","‚öõÔ∏èdispersion","‚öõÔ∏èinterf√©rence","‚öõÔ∏èdiffraction","‚öõÔ∏èpolarisation","‚öõÔ∏èfr√©quence","‚öõÔ∏èlongueur","‚öõÔ∏èamplitude","‚öõÔ∏èphase","‚öõÔ∏èvitesse","‚öõÔ∏èacc√©l√©ration","‚öõÔ∏èmomentum","‚öõÔ∏è√©nergie","‚öõÔ∏ètravail","‚öõÔ∏èpuissance","‚öõÔ∏èchaleur","‚öõÔ∏èfroid","‚öõÔ∏èentropie","‚öõÔ∏èenthalpie","‚öõÔ∏èthermodynamique","‚öõÔ∏èm√©canique","‚öõÔ∏èoptique","‚öõÔ∏èacoustique","‚öõÔ∏è√©lectricit√©","‚öõÔ∏èmagn√©tisme","‚öõÔ∏èchimie","‚öõÔ∏èbiologie","‚öõÔ∏èg√©ologie","‚öõÔ∏èastronomie","‚öõÔ∏èm√©t√©orologie","‚öõÔ∏èoc√©anographie","‚öõÔ∏è√©cologie","‚öõÔ∏èpal√©ontologie","‚öõÔ∏èarch√©ologie","‚öõÔ∏èhistoire","‚öõÔ∏èg√©ographie","‚öõÔ∏èsociologie","‚öõÔ∏èpsychologie","‚öõÔ∏èphilosophie","‚öõÔ∏è√©thique","‚öõÔ∏èjustice","‚öõÔ∏èlibert√©","‚öõÔ∏è√©galit√©","‚öõÔ∏èfraternit√©","‚öõÔ∏èd√©mocratie","‚öõÔ∏èr√©publique","‚öõÔ∏èmonarchie","‚öõÔ∏ètyrannie","‚öõÔ∏èanarchie","‚öõÔ∏ècommunisme","‚öõÔ∏èsocialisme","‚öõÔ∏ècapitalisme","‚öõÔ∏è√©conomie","‚öõÔ∏ècommerce","‚öõÔ∏èfinance","‚öõÔ∏èbanque","‚öõÔ∏èmonnaie","‚öõÔ∏èimp√¥t","‚öõÔ∏èdette","‚öõÔ∏ècr√©dit","‚öõÔ∏èmarch√©","‚öõÔ∏èoffre","‚öõÔ∏èdemande","‚öõÔ∏èproduction","‚öõÔ∏èconsommation","‚öõÔ∏èinvestissement","‚öõÔ∏ètravail","‚öõÔ∏èemploi","‚öõÔ∏èch√¥mage","‚öõÔ∏èsalaire","‚öõÔ∏èpauvret√©","‚öõÔ∏èrichesse","‚öõÔ∏èclasse","‚öõÔ∏èsoci√©t√©","‚öõÔ∏èculture","‚öõÔ∏ètradition","‚öõÔ∏ècoutume","‚öõÔ∏èreligion","‚öõÔ∏èmythe","‚öõÔ∏èl√©gende","‚öõÔ∏èfolklore","‚öõÔ∏èart","üé®peinture","üé®sculpture","üé®dessin","üé®gravure","üé®musique","üé∂chant","üé∂danse","üé≠th√©√¢tre","üé¨cin√©ma","üìölitt√©rature","üìúpo√©sie","üìñroman","üìúnouvelle","üìúessai","üìúbiographie","üìúautobiographie","üìúdictionnaire","üìúencyclop√©die","üìúmanuel","üìújournal","üì∞magazine","üåêsite","üì≤application","üéÆjeu","üèÜsport","‚öΩfootball","üèÄbasketball","üéætennis","üèêvolleyball","üèârugby","‚öæbaseball","üèíhockey","ü•äboxe","ü•ãjudo","üßòyoga","üèÉathl√©tisme","üö¥cyclisme","üèänatation","‚õµvoile","üé£p√™che","üèπchasse","üèïÔ∏ècamping","üö∂randonn√©e","‚õ∞Ô∏èescalade","‚õ∑Ô∏èski","üèÇsnowboard","üèÑsurf","üßòm√©ditation","üôèpri√®re","üïØÔ∏èrituel","‚õ™temple","üïåmosqu√©e","üïçsynagogue","‚õ™√©glise","üôèculte","üïäÔ∏èpaix","‚öîÔ∏èguerre","üî´arme","üõ°Ô∏èarmure","üí•bombe","üí£missile","üí•explosion","üí•ruine","üí•destruction","üí•catastrophe","üí•d√©sastre","üí•crise","üí•chaos","üí•ordre","üí•harmonie","üí•√©quilibre","üí•justice","üí•loi","üí•r√®gle","üí•principe","üí•valeur","üí•vertu","üí•vice","üí•p√©ch√©","üí•pardon","üí•r√©demption","üí•salut","üí•enfer","üí•paradis","üí•ange","üí•d√©mon","üí•fant√¥me","üí•monstre","üí•dragon","üí•f√©e","üí•gnome","üí•elfe","üí•nain","üí•g√©ant","üí•humain","üí•homme","üí•femme","üí•enfant","üí•famille","üí•amour","üí•amiti√©","üí•haine","üí•peur","üí•joie","üí•tristesse","üí•col√®re","üí•surprise","üí•d√©gout","üí•honte","üí•culpabilit√©","üí•fiert√©","üí•courage","üí•l√¢chet√©","üí•espoir","üí•d√©sespoir","üí•optimisme","üí•pessimisme","üí•sourire","üí•pleur","üí•rire","üí•chuchotement","üí•cri","üí•silence","üí•bruit","üí•musique","üí•rythme","üí•m√©lodie","üí•harmonie","üí•dissonance","üí•accord","üí•note","üí•cl√©","üí•gamme","üí•instrument","üí•voix","üí•ch≈ìur","üí•orchestre","üí•bande","üí•groupe","üí•soliste","üí•duo","üí•trio","üí•quatuor","üí•quintette","üí•sextuor","üí•septuor","üí•octuor","üí•ensemble","üí•concert","üí•r√©cital","üí•spectacle","üí•repr√©sentation","üí•performance","üí•artisanat","üí•savoir-faire","üí•comp√©tence","üí•talent","üí•don","üí•aptitude","üí•capacit√©","üí•potentiel","üí•limite","üí•d√©fi","üí•opportunit√©","üí•choix","üí•d√©cision","üí•action","üí•cons√©quence","üí•r√©sultat","üí•succ√®s","üí•√©chec","üí•victoire","üí•d√©faite","üí•progr√®s","üí•r√©gression","üí•stagnation","üí•d√©veloppement","üí•croissance","üí•d√©clin","üí•cycle","üí•saison","üí•printemps","üí•√©t√©","üí•automne","üí•hiver","üí•matin","üí•jour","üí•soir","üí•nuit","üí•aube","üí•cr√©puscule","üí•minuit","üí•midi","üí•heure","üí•minute","üí•seconde","üí•instant","üí•√©ternit√©","üí•pass√©","üí•pr√©sent","üí•futur","üí•m√©moire","üí•oubli","üí•souvenir","üí•nostalgie","üí•anticipation","üí•attente","üí•surprise","üí•hasard","üí•destin","üí•fortune","üí•malheur","üí•chance","üí•malchance","üí•√©v√©nement","üí•circonstance","üí•situation","üí•contexte","üí•relation","üí•connexion","üí•lien","üí•r√©seau","üí•syst√®me","üí•structure","üí•organisation","üí•hi√©rarchie","üí•communaut√©","üí•groupe","üí•individu","üí•soci√©t√©","üí•civilisation","üí•culture","üí•tradition","üí•innovation","üí•progr√®s","üí•r√©volution","üí•√©volution","üí•changement","üí•continuit√©","üí•stabilit√©","üí•√©quilibre","üí•d√©s√©quilibre","üí•conflit","üí•coop√©ration","üí•collaboration","üí•comp√©tition","üí•rivalit√©","üí•paix","üí•guerre","üí•alliance","üí•trait√©","üí•accord","üí•pacte","üí•serment","üí•promesse","üí•v√©rit√©","üí•mensonge","üí•secret","üí•r√©v√©lation","üí•doute","üí•certitude","üí•foi","üí•croyance","üí•religion","üí•dogme","üí•h√©r√©sie","üí•rite","üí•c√©r√©monie","üí•f√™te","üí•c√©l√©bration","üí•jubil√©","üí•anniversaire","üí•naissance","üí•bapt√™me","üí•mariage","üí•enterrement","üí•deuil","üí•comm√©moration","üí•h√©ritage","üí•patrimoine","üí•l√©gat","üí•testament","üí•don","üí•cadeau","üí•dette","üí•cr√©ance","üí•pr√™t","üí•emprunt","üí•argent","üí•pi√®ce","üí•billet","üí•monnaie","üí•fortune","üí•richesse","üí•pauvret√©","üí•mis√®re","üí•abondance","üí•manque","üí•besoin","üí•d√©sir","üí•envie","üí•satisfaction","üí•frustration","üí•plaisir","üí•douleur","üí•bonheur","üí•malheur","üí•bien","üí•mal","üí•vertu","üí•vice","üí•p√©ch√©","üí•gr√¢ce","üí•b√©n√©diction","üí•mal√©diction","üí•ch√¢timent","üí•r√©compense","üí•punition","üí•justice","üí•injustice","üí•droit","üí•devoir","üí•responsabilit√©","üí•libert√©","üí•esclavage","üí•tyrannie","üí•oppression","üí•r√©bellion","üí•r√©volution","üí•changement","üí•progr√®s","üí•d√©clin","üí•cycle","üí•fin","üí•d√©but","üá´üá∑Paris","üóΩNew York","üóºTokyo","üá¨üáßLondres","üáÆüáπRome","üá™üá¨Le Caire","üáßüá∑Rio de Janeiro","üá®üá≥Shanghai","üáÆüá≥New Delhi","üá¶üá∫Sydney","üá¶üá∑Buenos Aires","üá®üá¶Toronto","üá≤üáΩMexico","üáøüá¶Johannesburg","üá∑üá∫Moscou","üá©üá™Berlin","üá™üá∏Madrid","üá≥üá±Amsterdam","üáßüá™Bruxelles","üá¶üáπVienne","üá®üá≠Gen√®ve","üá∏üá¨Singapour","üáπüá≠Bangkok","üá∞üá∑S√©oul","üáÆüá±J√©rusalem","üá¨üá∑Ath√®nes","üáÆüá™Dublin","üáµüáπLisbonne","üáπüá∑Istanbul","üá®üá±Santiago","üáµüá™Lima","üá®üá¥Bogota","üáªüá™Caracas","üáµüá∞Karachi","üáßüá©Dhaka","üá≥üá¨Lagos","üá∏üá¶Riyad","üá∂üá¶Doha","üá¶üá™Duba√Ø","üáÆüá©Jakarta","üáµüá≠Manille","üáªüá≥Hano√Ø","üá∞üá™Nairobi","üá≤üá¶Casablanca","üá®üá∫La Havane","üáÆüá∏Reykjavik","üá´üáÆHelsinki","üá≥üá¥Oslo","üá∏üá™Stockholm","üá©üá∞Copenhague","üë®‚Äçüî¨Einstein","üë©‚Äçüî¨Marie Curie","üé®L√©onard de Vinci","‚úçÔ∏èShakespeare","üëëCl√©op√¢tre","‚öîÔ∏èNapol√©on","‚úùÔ∏èJ√©sus","üåçChristophe Colomb","üé§Michael Jackson","üëë√âlizabeth II","‚òØÔ∏èConfucius","üßòBouddha","üé§Elvis Presley","‚úçÔ∏èVictor Hugo","üî¨Galil√©e","üëëJeanne d'Arc","üé®Picasso","üéºMozart","üé∏Jimi Hendrix","üèÄMichael Jordan","ü•ãBruce Lee","üó≥Ô∏èNelson Mandela","üó≥Ô∏èAbraham Lincoln","üó≥Ô∏èGandhi","üìöJane Austen","üíªSteve Jobs","üíªBill Gates","üöÄElon Musk","üìöJ.K. Rowling","üé§Freddie Mercury","üé≠Charlie Chaplin","üíÉMarilyn Monroe","üë®‚ÄçüöÄNeil Armstrong","üë®‚Äçüç≥Gordon Ramsay","üë©‚Äçüç≥Julia Child","üé©Walt Disney","üìöStephen King","üé§Beyonc√©","‚öΩPel√©","‚öΩMaradona","üèéÔ∏èMichael Schumacher","üéøRoger Federer","üéæSerena Williams","üèéÔ∏èLewis Hamilton","üèéÔ∏èAyrton Senna","üë©‚Äç‚öïÔ∏èFlorence Nightingale","üó≥Ô∏èMartin Luther King","üëëLouis XIV","‚úçÔ∏èMoli√®re","üé®Vincent van Gogh","üß±Minecraft","üçÑSuper Mario","üî´Fortnite","üß©Tetris","üó°Ô∏èThe Legend of Zelda","üåçWorld of Warcraft","üöóGrand Theft Auto","üíªCyberpunk 2077","üëΩHalo","üó°Ô∏èElder Scrolls","ü§ñPac-Man","üëªAmong Us","üí•Call of Duty","üèéÔ∏èMario Kart","üöÄSpace Invaders","üëæPok√©mon","‚öîÔ∏èFinal Fantasy","ü™ìGod of War","üåÉRed Dead Redemption","üì¶Portal","üïµÔ∏èAssassin's Creed","üéÆFIFA","üèÄNBA 2K","ü•ãMortal Kombat","ü•ãStreet Fighter","üèéÔ∏èGran Turismo","üì¶Fallout","üèπSkyrim","ü§ñDetroit: Become Human","üê∫The Witcher","üßüResident Evil","üåÉSilent Hill","üéÆOverwatch","‚öΩRocket League","üéµGuitar Hero","üíÉJust Dance","üéØDestiny","ü§ñBorderlands","ü§ñApex Legends","üïπÔ∏èPong","üëæDonkey Kong","üöÄAsteroids","üêçSnake","üéÆCandy Crush","üïµÔ∏èHitman","üéÆDark Souls","üêâElden Ring","üí•Doom","üëæHalf-Life","ü¶Ålion","üêò√©l√©phant","ü¶ígirafe","üêÖtigre","üêªours","üêºpanda","ü¶ärenard","üê∫loup","ü¶åcerf","üêálapin","üêøÔ∏è√©cureuil","ü¶áchauve-souris","ü¶âhibou","ü¶Öaigle","ü¶úperroquet","ü¶¢cygne","üïäÔ∏ècolombe","ü¶ãpapillon","üêùabeille","üêûcoccinelle","üêúfourmi","ü¶ósauterelle","üï∑Ô∏èaraign√©e","üêçcobra","üêäalligator","üê†requin","üêôpieuvre","üê≥dauphin","ü¶çgorille","üêµsinge","üê®koala","ü¶ôlama","üê™chameau","ü¶òkangourou","üêßmanchot","ü¶©flamant rose","ü¶âchouette","ü¶âharfang","üê∫coyote","üêªgrizzly","üêÖl√©opard","ü¶årenne","ü¶®mouffette","ü¶°blaireau","ü¶¶loutre","ü¶´castor","ü¶ùraton laveur","ü¶äfennec","üêíchimpanz√©","ü¶íokapi","ü¶ìz√®bre","ü¶õhippopotame","ü¶èrhinoc√©ros","üêòmammouth","ü¶ñdinosaure","üêâdragon","ü¶Ñlicorne","üßú‚Äç‚ôÄÔ∏èsir√®ne","üßöf√©e","üßômagicien","üßüzombie","üßõvampire","üê∫loup-garou","üëªfant√¥me","üëΩalien","ü§ñrobot","üöÄfus√©e","üõ∞Ô∏èsatellite","üî≠t√©lescope","üî¨microscope","üì±smartphone","üíªordinateur","üñ•Ô∏è√©cran","‚å®Ô∏èclavier","üñ±Ô∏èsouris","üîåprise","üîãbatterie","üí°ampoule","üî¶lampe de poche","üìªradio","üì∫t√©l√©vision","üì∏appareil photo","üé•cam√©ra","üé§microphone","üéßcasque","üó£Ô∏èhaut-parleur","üñ®Ô∏èimprimante","üíødisque","üíæcl√© USB","üåêinternet","‚òÅÔ∏ènuage (informatique)","üîêcybers√©curit√©","üîëcl√© (cryptographie)","üìàgraphique","üìätableau","üìùdocument","üìölivre","üì∞journal","üìùplume","‚úèÔ∏ècrayon","‚úíÔ∏èencre","üìèr√®gle","‚úÇÔ∏èciseaux","üìétrombone","üìå√©pingle","üóìÔ∏ècalendrier","‚è∞r√©veil","‚è±Ô∏èchronom√®tre","‚è≥sablier","üó∫Ô∏ècarte","üìç√©pingle de carte","üß≠boussole","üî≠jumelles","üéísac √† dos","üíºmallette","üëõporte-monnaie","üîëcl√© (physique)","üö™porte","ü™üfen√™tre","üè†maison","üè¢immeuble","üè´√©cole","üè•h√¥pital","üè™magasin","üè≠usine","üöútracteur","üèóÔ∏ègrue","üöõcamion","üööfourgonnette","üöêminibus","üöåbus","üöÇtrain","üöám√©tro","üöÑTGV","üö¢navire","üõ•Ô∏èyacht","üõ∂kayak","‚õµvoilier","üö§hors-bord","üöÅh√©licopt√®re","‚úàÔ∏èavion","üõ∞Ô∏ènavette spatiale","üå†√©toile filante","üåån√©buleuse","üî≠constellation","ü™êgalaxie","‚òÄÔ∏ècom√®te","‚òÑÔ∏èast√©ro√Øde","üåïplan√®te","üåëmercure","‚ö™v√©nus","üî¥mars","üîµjupiter","üü¢saturne","üü†uranus","üü£neptune","üîµpluton","ü™êlune","üí´√©toile","‚òÄÔ∏èsoleil","‚ú®univers","üåàarc-en-ciel","‚ö°orage","üå™Ô∏ètornade","üåätsunami","üåãvolcan","‚õ∞Ô∏èmontagne","üèûÔ∏èvall√©e","üèúÔ∏ècanyon","üèùÔ∏è√Æle","üèñÔ∏èplage","üå≤for√™t","üå≥arbre fruitier","üåøarbuste","üéãbambou","üåæbl√©","üåΩma√Øs","ü•ïcarotte","ü•îpomme de terre","üßÖoignon","üçÖtomate","üå∂Ô∏èpiment","ü•íconcombre","üçÜaubergine","ü•¶brocoli","ü•¨laitue","üçäorange","üçãcitron","üçépomme","üçêpoire","üçìfraise","üçáraisin","üçâpast√®que","ü•ùkiwi","üççananas","ü••noix de coco","ü•≠mangue","ü•ëavocat","üçåbanane","üçícerise","üçëp√™che","ü´êmyrtille","üå∞ch√¢taigne","ü•úcacahu√®te","üçûpain","ü•êcroissant","ü•ñbaguette","üçïpizza","üçîhamburger","üçüfrites","üå≠hot-dog","üåÆtaco","üçúnouilles","üç£sushi","üçöriz","üçùp√¢tes","üç≤soupe","üçõcurry","üç≥≈ìuf (plat)","ü•ûcr√™pe","üßágaufre","üç©donut","üç™cookie","üç∞g√¢teau","üç¶glace","üç´chocolat","üç¨bonbon","üç≠sucre d'orge","üçØmiel","‚òïcaf√©","üçµth√©","ü•õlait","ü•§soda","üç∑vin","üç∫bi√®re","üç∏cocktail","ü•Çchampagne","üçæbouteille","üç¥fourchette","ü•Ñcuill√®re","üî™couteau","üçΩÔ∏èassiette","ü•£bol","ü•õverre","‚òïtasse","üç≥po√™le","üç≤casserole","üî™planche √† d√©couper","üßägla√ßon","üßÇsel","üå∂Ô∏èpoivre","üåøherbe aromatique","üßÑail","üßÖoignon","ü•îgingembre","ü•ïcarotte","ü•¶chou","üí®vapeur","üå´Ô∏èbrume","‚òÅÔ∏ènuage","üåßÔ∏èpluie","üåàarc-en-ciel","‚ùÑÔ∏èneige","üßäglace","‚ùÑÔ∏ègel","üåäoc√©an","üèûÔ∏èlac","üíßrivi√®re","üí¶goutte","üåãlave","ü™®pierre","‚õ∞Ô∏èroche","üèîÔ∏èmontagne","üèñÔ∏èsable","üèúÔ∏èd√©sert","üå¨Ô∏èdune","üå≥arbre","ü™µbois","üåøfeuille","üå∏fleur","üçÑchampignon","üåæherbe","üå±graine","üçéfruit","ü•ïl√©gume","üåæc√©r√©ale","üåªpollen","üçØmiel","üêùcire","ü•ö≈ìuf","ü¶¥os","ü™∂plume","üß∂laine","üßµcoton","üéãfibre","ü™πnid","üï∏Ô∏ètoile","üêöcoquille","üíécristal","‚ú®gemme","üí°lumi√®re","üåëobscurit√©","‚ö°foudre","üí•√©tincelle","‚≠ê√©toile","‚òÑÔ∏èm√©t√©ore","üåïlune","‚òÄÔ∏èsoleil","üåågalaxie","üåÄvent","üå™Ô∏ètornade","üßägr√™le","üå®Ô∏ègivre","üíßros√©e","üßästalagmite","üßästalactite","üíßsource","üå´Ô∏èbrouillard","üíßflotte","üíßhumide","üíßmouill√©","‚òÄÔ∏èsec","üü§glaise","ü™®gravier","üóørocher","‚ö™galet","üî™silex","üíéquartz","ü™®granit","‚ö™calcaire","üåãbasalte","üè∫argile","üñäÔ∏ècraie","üóømarbre","üñãÔ∏èardoise","ü™®gneiss","ü™®obsidienne","ü´ßponce","‚õèÔ∏èschiste","‚è≥gr√®s","üß™gypse","üçÇtourbe","‚õèÔ∏èminerai","‚¨õcharbon","üíédiamant","üåüor","ü•àargent","üü´cuivre","‚õìÔ∏èfer","ü•´√©tain","ü•âbronze","üî™acier","üß™mercure","üß™soufre","ü•õverre","üß±ciment","ü©πpl√¢tre","‚ö´goudron","‚ö´bitume","üõ¢Ô∏èp√©trole","‚õΩgaz","üõçÔ∏èplastique","üöócaoutchouc","üå≤r√©sine","üå≥s√®ve","üßºgomme"," ashes","üìúpapier","üì¶carton","üëïtissu","üëúcuir","üëòsoie","üåølin","üéãchanvre","üéçjute","üåøbambou","üß∫rotin","üåäcorail","ü©∏cendres"
      ];
      
      function parseElements(list) {
        const baseElements = { "air": "üå¨Ô∏è", "eau": "üíß", "feu": "üî•", "terre": "üåç" };
        for (const name in baseElements) {
            if (!emojis[name]) {
                emojis[name] = baseElements[name];
                allElementNames.push(name);
            }
        }
        list.forEach(item => {
          const firstLetterMatch = item.match(/[a-zA-Z√Ä-√ø]/);
          if (firstLetterMatch) {
            const index = firstLetterMatch.index;
            const emoji = item.substring(0, index).trim();
            const name = item.substring(index).trim();
            if (name && !emojis[name]) {
              emojis[name] = emoji;
              allElementNames.push(name);
            }
          }
        });
      }
      parseElements(elementsJsonContent);

      const startingElements = ["air", "eau", "feu", "terre"];
      const discovered = new Map();
      const FUSION_TOLERANCE = 50;

      // R√©f√©rences aux √©l√©ments du DOM
      const elementsList = document.getElementById("elements-list");
      const undiscoveredList = document.getElementById("undiscovered-list");
      const tabDiscovered = document.getElementById("tab-discovered");
      const tabUndiscovered = document.getElementById("tab-undiscovered");
      const sortButtonsContainer = document.getElementById("sort-buttons");
      
      const workspace = document.getElementById("workspace");
      const searchInput = document.getElementById("search");
      const themeToggle = document.getElementById("themeToggle");
      const cleanWorkspaceBtn = document.getElementById("cleanWorkspaceBtn");
      const sortByAgeBtn = document.getElementById("sortByAge");
      const sortByNameBtn = document.getElementById("sortByName");
      const sortByEmojiBtn = document.getElementById("sortByEmoji");
      const sortByRandomBtn = document.getElementById("sortByRandom");
      const backgroundCanvas = document.getElementById("backgroundCanvas");
      const backgroundCtx = backgroundCanvas.getContext("2d");
      const constellationCanvas = document.getElementById("constellationCanvas");
      const constellationCtx = constellationCanvas.getContext("2d");
      const sidebar = document.getElementById("sidebar");

      let currentSortType = 'age';

      // Code pour le fond anim√© (inchang√©)
      const POINT_COUNT = 150;
      const points = [];
      function randomSpeed() { return (Math.random() - 0.5) * 0.1; }
      function initializeConstellationPoints() {
        points.length = 0;
        for(let i=0; i<POINT_COUNT; i++) {
          points.push({ x: Math.random() * constellationCanvas.width, y: Math.random() * constellationCanvas.height, vx: randomSpeed(), vy: randomSpeed(), radius: 1.5 + Math.random() * 1.5, highlighted: false });
        }
      }
      function resizeCanvas() {
        const workspaceRect = workspace.getBoundingClientRect();
        backgroundCanvas.width = workspaceRect.width;
        backgroundCanvas.height = workspaceRect.height;
        constellationCanvas.width = workspaceRect.width;
        constellationCanvas.height = workspaceRect.height;
        if(workspaceRect.width > 0) { // Ne redessine que si la zone est visible
            initializeConstellationPoints();
        }
      }
      window.addEventListener("resize", resizeCanvas);
      const gridSpacing = 30;
      function drawGrid() {
        backgroundCtx.clearRect(0, 0, backgroundCanvas.width, backgroundCanvas.height);
        const isDark = document.body.classList.contains("dark");
        backgroundCtx.fillStyle = isDark ? "rgba(255,255,255,0.1)" : "rgba(50,50,50,0.15)";
        for(let x=0; x < backgroundCanvas.width; x += gridSpacing) {
          for(let y=0; y < backgroundCanvas.height; y += gridSpacing) {
            backgroundCtx.beginPath();
            backgroundCtx.arc(x, y, 1, 0, 2 * Math.PI);
            backgroundCtx.fill();
          }
        }
      }
      const maxDistance = 100;
      function drawConstellations() {
        constellationCtx.clearRect(0, 0, constellationCanvas.width, constellationCanvas.height);
        const isDark = document.body.classList.contains("dark");
        const pointColor = isDark ? "rgba(255,255,255,0.8)" : "rgba(30,30,30,0.8)";
        const lineColor = isDark ? "rgba(255,255,255,0.3)" : "rgba(30,30,30,0.3)";
        constellationCtx.lineWidth = 1;
        points.forEach(p => {
          p.x += p.vx;
          p.y += p.vy;
          if(p.x < 0 || p.x > constellationCanvas.width) p.vx = -p.vx;
          if(p.y < 0 || p.y > constellationCanvas.height) p.vy = -p.vy;
        });
        points.forEach(p => {
          constellationCtx.beginPath();
          constellationCtx.arc(p.x, p.y, p.radius, 0, 2 * Math.PI);
          constellationCtx.fillStyle = p.highlighted ? "rgba(255, 255, 0, 1)" : pointColor;
          constellationCtx.shadowBlur = p.highlighted ? 15 : 0;
          constellationCtx.shadowColor = p.highlighted ? "rgba(255, 255, 0, 0.8)" : "transparent";
          constellationCtx.fill();
        });
        for(let i=0; i < POINT_COUNT; i++) {
          for(let j=i+1; j < POINT_COUNT; j++) {
            const p1 = points[i];
            const p2 = points[j];
            const dist = Math.hypot(p1.x-p2.x, p1.y-p2.y);
            if(dist < maxDistance) {
              constellationCtx.beginPath();
              constellationCtx.moveTo(p1.x, p1.y);
              constellationCtx.lineTo(p2.x, p2.y);
              constellationCtx.strokeStyle = lineColor;
              constellationCtx.stroke();
            }
          }
        }
        const floatingElements = document.querySelectorAll(".floating-element");
        floatingElements.forEach(el => {
            const elRect = el.getBoundingClientRect();
            const elCenterX = (elRect.left + elRect.width / 2) - workspace.getBoundingClientRect().left;
            const elCenterY = (elRect.top + elRect.height / 2) - workspace.getBoundingClientRect().top;
            let closestPoint = null;
            let minDistance = Infinity;
            points.forEach(p => {
                const dist = Math.hypot(elCenterX - p.x, elCenterY - p.y);
                if (dist < minDistance) {
                    minDistance = dist;
                    closestPoint = p;
                }
            });
            if (closestPoint) {
                constellationCtx.beginPath();
                constellationCtx.moveTo(elCenterX, elCenterY);
                constellationCtx.lineTo(closestPoint.x, closestPoint.y);
                constellationCtx.strokeStyle = lineColor;
                constellationCtx.lineWidth = 1;
                constellationCtx.stroke();
            }
        });
      }
      function animateBackground() {
        drawGrid();
        drawConstellations();
        requestAnimationFrame(animateBackground);
      }

      function addElementToSidebar(name) {
        const el = document.createElement("div");
        el.className = "element";
        el.setAttribute("data-name", name);
        el.textContent = emojis[name] ? emojis[name] + " " + name : name;
        el.setAttribute("draggable", "true");
        el.addEventListener("dragstart", e => {
          e.dataTransfer.setData("text/plain", name);
          e.dataTransfer.effectAllowed = "copy";
        });
        el.addEventListener("click", () => spawnElementRandomly(name));
        elementsList.appendChild(el);
        setTimeout(() => el.classList.add('animate-in'), 10);
      }
      
      function addUndiscoveredElementToSidebar(name) {
        const el = document.createElement("div");
        el.className = "element undiscovered-element";
        el.setAttribute("data-name", name);
        el.textContent = emojis[name] ? emojis[name] + " " + name : "? " + name;
        undiscoveredList.appendChild(el);
      }

      function renderElementsList(sortType = currentSortType) {
        elementsList.innerHTML = '';
        undiscoveredList.innerHTML = '';
        currentSortType = sortType;

        document.querySelectorAll('#sort-buttons button').forEach(button => {
          button.classList.toggle('active', button.id === `sortBy${sortType.charAt(0).toUpperCase() + sortType.slice(1)}`);
        });

        let discoveredArray = Array.from(discovered.entries()).map(([name, time]) => ({ name: name, time: time, emoji: emojis[name] || '' }));
        switch (sortType) {
          case 'age': discoveredArray.sort((a, b) => a.time - b.time); break;
          case 'name': discoveredArray.sort((a, b) => a.name.localeCompare(b.name)); break;
          case 'random': discoveredArray.sort(() => Math.random() - 0.5); break;
          case 'emoji': discoveredArray.sort((a, b) => a.emoji.localeCompare(b.emoji)); break;
        }
        discoveredArray.forEach(elData => addElementToSidebar(elData.name));

        const undiscoveredNames = allElementNames.filter(name => !discovered.has(name));
        undiscoveredNames.sort((a, b) => a.localeCompare(b));
        undiscoveredNames.forEach(name => addUndiscoveredElementToSidebar(name));

        tabDiscovered.textContent = `D√©couverts (${discovered.size})`;
        tabUndiscovered.textContent = `√Ä d√©couvrir (${undiscoveredNames.length})`;
      }

      function saveDiscoveredElements() { localStorage.setItem('littleAlchemyDiscovered', JSON.stringify(Array.from(discovered.entries()))); }
      function loadDiscoveredElements() {
        const storedData = localStorage.getItem('littleAlchemyDiscovered');
        if (storedData) { JSON.parse(storedData).forEach(([name, time]) => discovered.set(name, time)); } 
        else { startingElements.forEach(name => discovered.set(name, Date.now())); }
      }

      function spawnFloatingElement(name, x, y, animate) {
        const el = document.createElement("div");
        el.className = "floating-element";
        el.textContent = emojis[name] ? emojis[name] + " " + name : name;
        el.style.left = x + "px";
        el.style.top = y + "px";
        el.setAttribute("data-name", name);
        el.setAttribute("draggable", "true");
        el.addEventListener("dragstart", e => {
          e.dataTransfer.setData("text/plain", name);
          e.dataTransfer.setData("offsetX", e.offsetX);
          e.dataTransfer.setData("offsetY", e.offsetY);
          draggingElement = el;
        });
        el.addEventListener("dragend", e => { draggingElement = null; });
        workspace.appendChild(el);
        if(animate) {
          el.classList.add("combine-animation");
          setTimeout(() => el.classList.remove("combine-animation"), 400);
        }
        return el;
      }
      
      function spawnElementRandomly(name) {
        const x = Math.random() * (workspace.clientWidth - 100);
        const y = Math.random() * (workspace.clientHeight - 40);
        spawnFloatingElement(name, x, y, true);
      }

      function combine(name1, name2) {
        const possibleResults = allElementNames.filter(name => name !== name1 && name !== name2);
        if (possibleResults.length === 0) { return allElementNames[Math.floor(Math.random() * allElementNames.length)]; }
        const randomIndex = Math.floor(Math.random() * possibleResults.length);
        return possibleResults[randomIndex];
      }

      function tryCombineWithOthers(movingEl) {
        const floatingEls = [...workspace.querySelectorAll(".floating-element")].filter(el => el !== movingEl);
        const movingRect = movingEl.getBoundingClientRect();
        for(let el of floatingEls) {
          const r = el.getBoundingClientRect();
          const overlapX = Math.abs((movingRect.left + movingRect.width/2) - (r.left + r.width/2)) < FUSION_TOLERANCE;
          const overlapY = Math.abs((movingRect.top + movingRect.height/2) - (r.top + r.height/2)) < FUSION_TOLERANCE;
          if(overlapX && overlapY) {
            const name1 = movingEl.getAttribute("data-name");
            const name2 = el.getAttribute("data-name");
            const result = combine(name1, name2);
            if(result) {
              const x = (movingRect.left + r.left)/2 - workspace.getBoundingClientRect().left;
              const y = (movingRect.top + r.top)/2 - workspace.getBoundingClientRect().top;
              const isNewDiscovery = !discovered.has(result);
              if(isNewDiscovery) {
                discovered.set(result, Date.now());
                saveDiscoveredElements();
                renderElementsList();
              }
              const newEl = spawnFloatingElement(result, x, y, true);
              if (isNewDiscovery) {
                newEl.classList.add('new-element-animation');
                newEl.addEventListener('animationend', () => newEl.classList.remove('new-element-animation'), { once: true });
              }
              movingEl.remove();
              el.remove();
              return true;
            }
          }
        }
        return false;
      }

      let draggingElement = null;
      workspace.addEventListener("dragover", e => { e.preventDefault(); });
      workspace.addEventListener("drop", e => {
        e.preventDefault();
        const workspaceRect = workspace.getBoundingClientRect();
        let dropX = e.clientX - workspaceRect.left;
        let dropY = e.clientY - workspaceRect.top;
        const name = e.dataTransfer.getData("text/plain");

        if (draggingElement) {
            const offsetX = parseInt(e.dataTransfer.getData("offsetX"));
            const offsetY = parseInt(e.dataTransfer.getData("offsetY"));
            draggingElement.style.left = (dropX - offsetX) + "px";
            draggingElement.style.top = (dropY - offsetY) + "px";
            tryCombineWithOthers(draggingElement);
        } else {
            let fused = false;
            for (let el of [...workspace.querySelectorAll(".floating-element")]) {
                const r = el.getBoundingClientRect();
                const elCenterX = r.left - workspaceRect.left + r.width / 2;
                const elCenterY = r.top - workspaceRect.top + r.height / 2;
                if (Math.hypot(dropX - elCenterX, dropY - elCenterY) < FUSION_TOLERANCE) {
                    const result = combine(name, el.getAttribute("data-name"));
                    if (result) {
                        const isNew = !discovered.has(result);
                        if(isNew) { discovered.set(result, Date.now()); saveDiscoveredElements(); renderElementsList(); }
                        const newEl = spawnFloatingElement(result, elCenterX, elCenterY, true);
                        if(isNew) { newEl.classList.add('new-element-animation'); newEl.addEventListener('animationend', () => newEl.classList.remove('new-element-animation'), { once: true }); }
                        el.remove();
                        fused = true;
                        break;
                    }
                }
            }
            if (!fused) {
                const tempEl = document.createElement("div");
                tempEl.className = "floating-element"; tempEl.style.visibility = "hidden"; tempEl.textContent = name;
                workspace.appendChild(tempEl);
                const elWidth = tempEl.offsetWidth; const elHeight = tempEl.offsetHeight;
                workspace.removeChild(tempEl);
                spawnFloatingElement(name, dropX - elWidth / 2, dropY - elHeight / 2);
            }
        }
      });

      sidebar.addEventListener("dragover", e => { e.preventDefault(); });
      sidebar.addEventListener("drop", e => {
        e.preventDefault();
        if (draggingElement) {
          draggingElement.classList.add('disappear-animation');
          setTimeout(() => { draggingElement.remove(); }, 300);
        }
      });
      
      // Listeners pour les boutons
      function toggleTheme() {
        document.body.classList.toggle("dark");
        themeToggle.textContent = document.body.classList.contains("dark") ? "‚ö´" : "‚ö™";
      }
      themeToggle.addEventListener("click", toggleTheme);
      cleanWorkspaceBtn.addEventListener("click", () => {
        [...workspace.querySelectorAll(".floating-element")].forEach(el => {
          el.classList.add('disappear-animation');
          setTimeout(() => el.remove(), 300);
        });
      });
      sortByAgeBtn.addEventListener('click', () => renderElementsList('age'));
      sortByNameBtn.addEventListener('click', () => renderElementsList('name'));
      sortByEmojiBtn.addEventListener('click', () => renderElementsList('emoji'));
      sortByRandomBtn.addEventListener('click', () => renderElementsList('random'));
      
      // Logique des onglets
      function switchTab(activeTab) {
          if (activeTab === 'discovered') {
              tabDiscovered.classList.add('active');
              tabUndiscovered.classList.remove('active');
              elementsList.style.display = 'block';
              undiscoveredList.style.display = 'none';
              sortButtonsContainer.style.display = 'flex';
          } else {
              tabDiscovered.classList.remove('active');
              tabUndiscovered.classList.add('active');
              elementsList.style.display = 'none';
              undiscoveredList.style.display = 'block';
              sortButtonsContainer.style.display = 'none';
          }
      }
      tabDiscovered.addEventListener('click', () => switchTab('discovered'));
      tabUndiscovered.addEventListener('click', () => switchTab('undiscovered'));

      // Initialisation finale
      loadDiscoveredElements();
      renderElementsList('age');
      switchTab('discovered');
      themeToggle.textContent = document.body.classList.contains("dark") ? "‚ö´" : "‚ö™";
      resizeCanvas();
      animateBackground();
    });
  </script>
</body>
</html>